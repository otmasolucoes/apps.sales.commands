<!DOCTYPE html>
<html lang="pt-br" xmlns:script="http://www.w3.org/1999/html">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Melinux - Controle de comandas</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'bower_components/bootstrap/dist/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'bower_components/font-awesome/css/all.min.css' %}">

    <script src="{% static 'bower_components/vue/dist/vue.js' %}"></script>
    <script src="{% static 'base_controller.js' %}"></script>
    <script src="{% static 'commands_controller.js' %}"></script>

    <style>
      /*
        AUTO GRID
        Set the minimum item size with `--auto-grid-min-size` and you'll
        get a fully responsive grid with no media queries.
      */

      .auto-grid-large {
        --auto-grid-min-size: 14rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
        grid-gap: 1rem;
      }

      .auto-grid-small {
        --auto-grid-min-size: 6rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
        grid-gap: 1rem;
      }

      #table-panel .auto-grid-large {
        --auto-grid-min-size: 8rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
        grid-gap: 1rem;
      }

      #table-panel .auto-grid-small {
        --auto-grid-min-size: 4rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
        grid-gap: 1rem;
      }

      /* Presentational styles */
      body {
        background-image: url("/static/apps/sales/commands/images/background-sm.png");
        line-height: 1.4;
        font-family: Tahoma, Geneva, sans-serif;
      }

      #table-panel li {
        text-align: left;
        background: #ccc;
        color: #ffffff;
      }

      #table-panel li.opened {
        background: #429742;
      }

      #table-panel li.waiting {
        background: #c60000;
      }

      #consumed_products td {
        padding:10px;
      }


      ul #product-menu{
        list-style-type: none;
      }

      ul#product-menu li {
        text-align: left;
        /*background: rgb(178,34,34,0.85);*/
        /*background: linear-gradient(0deg, rgba(178,34,34,1) 0%, rgba(178,34,34,1) 92%, rgba(134,28,28,1) 100%);*/
        color: #ffffff;
      }

      ul#product-menu li span {
        position: relative;
        left:4px;
        top: 4px;
      }

      ul#product-menu li:hover {
        /*background: #8e1b1b;*/
        /*filter: grayscale(20%);*/
        /*background: hsla(180,0%,50%,0.5);*/
        /*background-color: rgba(var(--rgb), 0.8);*/

        /*background-image:linear-gradient(hsla(255,100%,100%,.8) 100%,transparent 100%)*/
        background: rgb(178,34,34,1.0);
      }

      ul#product-menu li:hover {
        filter:brightness(120%);
      }

      .auto-grid-small {
        font-size: 9px;
      }

      .auto-grid-large {
        font-size: 1.0rem;
      }

      .menu-item-image{
        object-fit:cover;
        width:100%;
        height:155px;
      }

      .auto-grid-small .menu-item-image{
        height:70px;
      }

      .menu-item-price{
        border-bottom-left-radius: 5px;
        text-align: right;
        color: #b22222;
        height: 20px;
        float: right;
      }

      .auto-grid-large .menu-item-price{
        padding-left:20px;
        padding-top: 0px;
        margin-top:-155px;
        font-size:14px;
      }

      .auto-grid-small .menu-item-price{
        padding-left:15px;
        margin-top:-73px;
        padding-top:3px;
        font-size:11px;
      }

      #product_complements, #product_description {
        font-size:12px;
      }

      #product_complements thead tr td{
        font-size:10px;
        border-top: none;
      }

      #product_complements td, #product_description td{
        vertical-align:middle;
      }

      .selected {
        background:#237dd7;
        color: white !important;
      }

      .order_decoration {
        font-family:arial;
        padding:10px;
        margin-top:-65px;
        height:65px;
        /*background-color: rgba(28, 28, 28, 0.90);*/
        color:white;
      }

    </style>
  </head>

  <body>
    <div style='padding:0px;'>
      <div id="app" @mousemove="" @keyup="">
        <div :style='controls.styles.themes.active.header'>

          <div :style='controls.styles.themes.active.header_division'>
            <table border='0' style="width:100%;">
              <tr>
                <td style="width:40px;" title="Retornar a pagina anterior"><!-- v-if='controls.screen.fullscreen_mode'-->
                  <span @click="back_menu()" style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;"><!-- @click="selected.table=null" v-if="selected.table!=null"  -->
                    <i class="fas fa-arrow-left"></i>
                  </span>
                </td>

                <td style="padding-left:10px;text-align:left;font-family:Brush Script MT, Brush Script Std, cursive;font-size:30px;">{{ company_name }}</td>

                <td style="width:40px;" title="Minhas Notificações">
                  <span style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;">
                    <i class="fas fa-bell"></i>
                  </span>
                </td>

                <i class="fas fa-shopping-cart"></i>

                <td v-if="selected.table==null" style="width:40px;">
                  <div class="dropdown">
                    <span class="" id="dropdownMenuButton" title="Filtrar mesas" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;">
                      <i class="fas fa-filter"></i>
                    </span>

                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="font-size:12px;">
                      <a class="dropdown-item" href="#" @click="selected.table_group='INTERNA'" style="padding-right:10px;">
                        Mesas internas <i v-if="selected.table_group=='INTERNA'" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                      </a>

                      <a class="dropdown-item" href="#" @click="selected.table_group='EXTERNA'" style="padding-right:10px;">
                        Mesas externas <i v-if="selected.table_group=='EXTERNA'" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                      </a>
                      <a class="dropdown-item" href="#" @click="selected.table_group='WAITING'" style="padding-right:10px;">
                        Mesas aguardando <i v-if="selected.table_group=='WAITING'" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                      </a>

                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" href="#" @click="selected.table_group='GERAL'" style="padding-right:10px;">
                        Todas as mesas <i v-if="selected.table_group=='GERAL'" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                      </a>
                    </div>
                  </div>
                </td>

                <td style="width:40px;">
                  <div class="dropdown">
                    <span class="" id="dropdownMenuButton" title="Preferências" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;">
                      <i class="fas fa-tools"></i>
                    </span>

                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="font-size:12px;">
                      {% verbatim %}
                      <template v-for="theme in controls.styles.themes.options">
                        <a class="dropdown-item" href="#" @click="controls.styles.themes.active=theme" style="padding-right:10px;">
                          {{ theme.name }} <i v-if="controls.styles.themes.active.name==theme.name" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                        </a>
                      </template>
                      {% endverbatim %}
                    </div>
                  </div>
                </td>

                <td style="width:40px;">
                  <div class="dropdown">
                    <span class="" style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fas fa-user"></i>
                    </span>

                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <a class="dropdown-item" href="#">Nada ainda</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" href="/logout">Sair</a>
                    </div>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>

        {% verbatim %}
        <div style="padding:15px;">
          <template v-if="selected.new_product">
            <app_commands :controls="controls" :forms="forms" :selected="selected" :groups="groups" :complements="complements" :init_complements="init_complements" :new_products="selected.new_products"></app_commands>
          </template>

          <div v-else-if='selected.table==null' id="table-panel">
            <ul id='tables-list' :class="{'auto-grid-small':controls.screen.width<1024, 'auto-grid-large':controls.screen.width>=1024}" style='margin-left:-40px;'>
              <template v-for='(table, table_index) in tables'>
                <li v-if="table.area==selected.table_group || table.status==selected.table_group || selected.table_group=='GERAL'" @click="select_table(table, table_index)" :class="{'opened':table.status=='ACTIVE', 'waiting':table.status=='WAITING'}" style='vertical-align:middle;padding:5px;cursor:pointer;padding-bottom:10px;padding-top:10px;line-height:15px;'>
                  <div style="text-align:center;">
                    <i v-if="table.status=='WAITING'" class="fas fa-user-clock fa-3x"></i>
                    <i v-else-if="table.status=='ACTIVE'" class="fas fa-users fa-3x"></i>
                    <i v-else class="fas fa-users fa-3x"></i>
                    <br>
                    <span style="position:relative;top:4px;">Mesa {{ table.code }}</span><br>
                    <span style="font-size:10px;">{{ table.area }}</span>
                  </div>
                </li>
              </template>
            </ul>
          </div>

          <div class="" v-else style="height: calc(100vh - 150px);">
            <div>
              <h6 style="height:30px;background:white;padding-left:5px;padding-right:5px;">
                <div class="float-left" style="position:relative;top:0px;">
                  <div class="dropdown">

                      <button class="btn btn-sm btn-light" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="false" aria-expanded="false">
                        <i class="fas fa-bars"></i>
                      </button>
                      <span style="position:relative;top:2px">Mesa {{ selected.table.code }}</span>


                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <a class="dropdown-item" href="#" style="font-size:12px;padding-left:15px;padding-right:5px;" @click="open_command(selected.table, selected.table_index)"><i class="fas fa-plus"></i> Adicionar comanda</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" @click="view_order()" style="cursor:pointer;font-size:12px;padding-left:15px;padding-right:5px;"><i class="fas fa-search"></i> Visualizar pedido</a>
                      <a class="dropdown-item" style="cursor:pointer;font-size:12px;padding-left:15px;padding-right:5px;"><i class="fas fa-print"></i> Reimprimir pedido</a>
                      <a class="dropdown-item" href="#" style="cursor:pointer;font-size:12px;padding-left:15px;padding-right:5px;"><i class="fas fa-times"></i> Cancelar pedido</a>
                    </div>
                  </div>
                </div>

                <div class="float-right">
                  <span style="position:relative;left:-10px;top:7px;color:#777;font-family:Arial;">R$ {{ selected.table.total | format_money }}</span>
                </div>
              </h6>
            </div>

            <template v-if="selected.table.commands.length==0">
              Nenhuma comanda aberta nessa mesa
            </template>

            <template v-else v-for="(command,command_index) in selected.table.commands">
              <div id="consumed_products_panel" style="background:white;padding:10px;border:1px solid #ddd;">
                <div style="height:50px;padding-bottom:40px;border-bottom:1px solid #ddd;">
                  <h6 class="float-left" style="position:relative;top:3px;">
                    Comanda {{ command.code }}<br>
                    <span style="font-size:12px;color:#666;">
                      Cliente não identificado
                      <!--<template v-if="command.client">{{ command.client }}</template>
                      <template v-else>
                        <input v-if="forms.command.change_client_name" class="form-control" v-model="command.client" style="border-top:0px;border-left:0px;border-right:0px;"/><!- @submit="confirm_client_name_field()"  ->
                        <a v-else style="cursor:pointer;">Identificar cliente</a><-- data-toggle="modal" href="#update_command_client_modal" >
                      </template>-->

                      <!--<template v-if="controls.screen.width>600">Entrada:</template>{{ command.checkin_time | format_datetime }}-->
                    </span>
                  </h6>

                  <div class="float-right" style="position:relative;top:0px;padding-right:0px;">
                    <button type="button" class="btn btn-sm btn-light" @click="open_menu(command, command_index)" style="line-height:1;height:38px;">
                      <i class="fas fa-plus"></i><br><span style="font-size:10px;">Adicionar</span>
                    </button>

                    <button v-if="controls.screen.width>=1024" :disabled="!(selected.order && selected.command_index==command_index)" @click="view_order()" type="button" class="btn btn-sm btn-light" style="line-height:1;height:38px;">
                      <i class="fas fa-print"></i><br><span style="font-size:10px;">Imprimir</span>
                    </button>

                    <button :disabled="!(selected.order && selected.command_index==command_index)" type="button" class="btn btn-sm btn-light" @click="repeat_order(command, command_index, selected.order)" data-toggle="modal" data-target="#exampleModal" style="line-height:1;height:38px;">
                      <i class="fas fa-redo-alt"></i><br><span style="font-size:10px;">Repetir</span>
                    </button>

                    <!--<button :disabled="!(selected.order && selected.command_index==command_index)" type="button" class="btn btn-sm btn-light" @click="open_menu(command, command_index)" style="line-height:1;height:38px;">
                      <i class="fas fa-print"></i><br><span style="font-size:10px;">Imprimir</span>
                    </button>

                    <button :disabled="!(selected.order && selected.command_index==command_index)" type="button" class="btn btn-sm btn-light" @click="open_menu(command, command_index)" style="line-height:1;height:38px;">
                      <i class="fas fa-times"></i><br><span style="font-size:10px;">Cancelar</span>
                    </button>-->

                    <button :disabled="!(selected.order && selected.command_index==command_index)" type="button" class="btn btn-sm btn-light" @click="open_menu(command, command_index)" style="line-height:1;height:38px;">
                      <i class="fas fa-sign-out-alt"></i><br><span style="font-size:10px;">Encerrar</span>
                    </button>

                    <!--<button type="button" class="btn btn-sm btn-secondary" style="line-height:1;width:110px;height:38px;"><span style="font-size:13px;font-weight:bold;">R$ {{ command.total }}</span><br><span style="font-size:10px;"><i class="fas fa-sign-out-alt"></i> Encerrar</span></button>-->

                    <!--<div class="btn-group">
                      <button type="button" class="btn btn-sm btn-secondary" style="line-height:1;width:115px;height:38px;" @click="close_command(command)">
                        <span style="font-weight:bold;font-size:15px;">R$ {{ command.total }}</span><br>
                        <span style="font-size:10px;"><i class="fas fa-sign-out-alt"></i> Encerrar</span>
                      </button>

                      <template v-if="command.total>0">
                      <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="sr-only">Toggle Dropdown</span>
                      </button>
                      <div class="dropdown-menu" style="font-size:11px;">
                        <a class="dropdown-item" href="#">R$ {{ command.total/2 | round }} para 2 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/3 | round }} para 3 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/4 | round }} para 4 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/5 | round }} para 5 pessoas</a>

                        <template v-if="command.total >= 300">
                        <a class="dropdown-item" href="#">R$ {{ command.total/6 | round }} para 6 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/7 | round }} para 7 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/8 | round }} para 8 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/9 | round }} para 9 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/10 | round }} para 10 pessoas</a>
                        </template>

                        <template v-if="command.total >= 500">
                        <a class="dropdown-item" href="#">R$ {{ command.total/11 | round }} para 11 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/12 | round }} para 12 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/13 | round }} para 13 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/14 | round }} para 14 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/15 | round }} para 15 pessoas</a>
                        </template>
                      </div>
                      </template>
                    </div>-->
                  </div>
                </div>

                <br>

                <template v-if="command.orders && command.orders.length>0">
                  <table border="0" id='consumed_products' class='table table-sm table-stripped' style='font-family:arial;margin-bottom:0px;'>
                    <template v-if='controls.screen.width>=1024'>
                      <thead>
                        <tr style="font-size:10px;font-weight:bold;font-weight:bold;">
                          <td style="text-align:left;border-top:none;">Produtos</td>
                          <td style="text-align:center;border-top:none;"></td>
                          <td style="text-align:center;border-top:none;"></td>
                          <td style="text-align:center;border-top:none;">Quant</td>
                          <td style="text-align:center;border-top:none;">Preço</td>
                          <td style="text-align:center;border-top:none;">Total</td>
                        </tr>
                      </thead>

                      <tbody>
                        <template v-for='(order, order_index) in command.orders'>
                        <tr :class="{'selected':order.show_options}" style="cursor:pointer;" @click="show_options(command_index, order, order_index)"><!-- data-toggle="modal" data-target="#command_item_options" -->
                          <td style="width:100px;">
                            <img :src="'/media/'+order.image" style='width:90px;height:60px;object-fit:cover;' />
                          </td>

                          <td style="line-height:1.1;">
                            <span style='font-size:18px;'>{{ order.name }}</span><br>
                            <span style='font-size:12px;color:#888;'>Entrada: {{ order.checkin_time | format_time_short }} -
                            <template v-if="order.checkout_time==null">Previsão: {{ order.expected_time | format_time_short }}</template>
                            <template v-else>Entrega: {{ order.checkout_time | format_time_short }}</template></span>
                            <br>
                            <span style='font-size:12px;color:#888;'>Observações: {{ order.observations }}</span>
                          </td>

                          <td style='width:40px;vertical-align:middle;text-align:center;'>
                            <template v-if="order.status=='WAITING'">
                              AGUARDANDO
                            </template>

                            <template v-else-if="order.status=='IN_PROGRESS'">
                              ANDAMENTO
                            </template>

                            <template v-else-if="order.status=='READY'">
                              PRONTO
                            </template>

                            <template v-else-if="order.status=='CANCELED'">
                              CANCELADO
                            </template>

                            <template v-else>
                              ENTREGUE
                            </template>

                            <template v-if="(controls.clock > order.expected_time) && (order.status=='WAITING' || order.status!='IN_PROGRESS' || order.status!='READY')">
                              <span style="color:red;font-size:12px;"><b>ATRASADO</b></span>
                            </template>
                          </td>

                          <td style='width:110px;text-align:center;vertical-align:middle;'>
                            <span style='font-size:18px;'>{{ order.quantity | format_money }}</span>
                          </td>

                          <td style="vertical-align:middle;text-align:center;width:110px;">
                            <span style='font-size:18px;'>R$ {{ order.price | format_money }}</span>
                          </td>

                          <td style='width:110px;text-align:center;vertical-align:middle;'>
                            <span style='font-size:18px;'>R$ {{ order.total | format_money }}</span>
                          </td>
                          </template>
                        </tr>

                        <tr>
                          <td colspan="4"></td>
                          <td colspan="2" style="text-align:right;"><b>R$ {{ command.total | format_money }}</b></td>
                        </tr>

                        <!--<tr>
                          <td colspan="4">
                            <div class="btn-group">
                              <button type="button" class="btn btn-sm btn-secondary" style="line-height:1;height:38px;">
                                <span style="font-weight:bold;font-size:15px;">Não identificado</span><br>
                                <span style="font-size:10px;"><i class="fa fa-user"></i> Cliente</span>
                              </button>
                            </div>

                            <div class="dropdown">
                              <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span style="font-weight:bold;font-size:15px;">R$ {{ command.total }}</span><br>
                                <span style="font-size:10px;"><i class="fas fa-hand-holding-usd"></i> Por pessoa</span>
                              </button>

                              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                <a class="dropdown-item" href="#">Action</a>
                                <a class="dropdown-item" href="#">Another action</a>
                                <a class="dropdown-item" href="#">Something else here</a>
                              </div>
                            </div>

                            <div class="btn-group">
                              <template v-if="command.total>0">
                              <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width:100px;">
                                <span style="font-weight:bold;font-size:15px;">R$ {{ command.total }}</span><br>
                                <span style="font-size:10px;"><i class="fas fa-hand-holding-usd"></i> Por pessoa</span>
                              </button>
                              <div class="dropdown-menu" style="font-size:11px;">
                                <a class="dropdown-item" href="#">R$ {{ command.total/2 | round }} para 2 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/3 | round }} para 3 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/4 | round }} para 4 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/5 | round }} para 5 pessoas</a>

                                <template v-if="command.total >= 300">
                                <a class="dropdown-item" href="#">R$ {{ command.total/6 | round }} para 6 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/7 | round }} para 7 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/8 | round }} para 8 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/9 | round }} para 9 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/10 | round }} para 10 pessoas</a>
                                </template>

                                <template v-if="command.total >= 500">
                                <a class="dropdown-item" href="#">R$ {{ command.total/11 | round }} para 11 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/12 | round }} para 12 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/13 | round }} para 13 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/14 | round }} para 14 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/15 | round }} para 15 pessoas</a>
                                </template>
                              </div>
                              </template>
                            </div>
                          </td>


                          <td colspan="2">
                            <div class="btn-group">
                              <button type="button" class="btn btn-sm btn-secondary" style="line-height:1;width:115px;height:38px;" @click="close_command(command)">
                                <span style="font-weight:bold;font-size:15px;">R$ {{ command.total }}</span><br>
                                <span style="font-size:10px;"><i class="fas fa-sign-out-alt"></i> Encerrar</span>
                              </button>

                              <template v-if="command.total>0">
                              <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="sr-only">Toggle Dropdown</span>
                              </button>
                              <div class="dropdown-menu" style="font-size:11px;">
                                <a class="dropdown-item" href="#">R$ {{ command.total/2 | round }} para 2 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/3 | round }} para 3 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/4 | round }} para 4 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/5 | round }} para 5 pessoas</a>

                                <template v-if="command.total >= 300">
                                <a class="dropdown-item" href="#">R$ {{ command.total/6 | round }} para 6 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/7 | round }} para 7 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/8 | round }} para 8 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/9 | round }} para 9 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/10 | round }} para 10 pessoas</a>
                                </template>

                                <template v-if="command.total >= 500">
                                <a class="dropdown-item" href="#">R$ {{ command.total/11 | round }} para 11 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/12 | round }} para 12 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/13 | round }} para 13 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/14 | round }} para 14 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/15 | round }} para 15 pessoas</a>
                                </template>
                              </div>
                              </template>
                            </div>
                          </td>
                        </tr>-->
                      </tbody>
                    </template>

                    <template v-else>
                      <thead>
                        <tr style="font-size:10px;font-weight:bold;font-weight:bold;">
                          <td style="text-align:left;border-top:none;">Pedidos</td>
                        </tr>
                      </thead>

                      <tbody>
                        <template v-for='(order,index) in command.orders'>
                          <tr :class="{'selected':order.show_options}" @click="show_options(command_index, order, index)" style="cursor:pointer;">
                            <td style="padding-top:4px;padding-bottom:10px;line-height:1;">
                              <span style="font-size:14px;">{{ order.quantity }} x {{ order.name }}</span><br>

                              <span style='font-size:12px;position:relative;top:2px;'>
                                <span style="padding-right:8px;"><i class="fas fa-arrow-up" style=""></i> {{ order.checkin_time | format_time_short }}</span>

                                <span style="padding-right:8px;">
                                  <template v-if="order.checkout==null"><i class="fas fa-clock"></i> {{ order.expected_time | format_time_short }}</template>

                                <template v-else><i class="fas fa-arrow-down" style="color:green;">{{ order.checkout | format_time_short }}</i></template></span>

                                <span style="">
                                  <template v-if="(controls.clock > order.expected_time) && (order.status=='WAITING' || order.status!='IN_PROGRESS' || order.status!='READY')">
                                    <span style="color:#a60e0e;font-size:12px;">ATRASADO</span>
                                  </template>
                                </span>
                              </span>
                            </td>

                            <td style="text-align:right;">
                              <div @click="show_options(order)">{{ order.total }}</div>
                            </td>
                          </tr>
                        </template>
                      </tbody>
                    </template>
                  </table>
                </template>

                <template v-else>
                  <div style="text-align:center;padding:10px;">
                    Nenhum pedido feito.. <br><span @click="open_menu(selected.table.commands[command_index], command_index)" style="cursor:pointer;font-weight:bold;">clique aqui para adicionar um novo pedido..</span>
                    <br>
                  </div>
                </template>
              </div>
              <br>
            </template>
          </div>
        </div>

        <div id="exampleModal" class="modal" tabindex="-1" role="dialog">
          <div class="modal-dialog modal-lg" role="document">
            <div v-if='selected.product ' class="modal-content">
              <div class="modal-header" style='padding:0px;'>
                <img :src="'/media/'+(forms.order.object.image||forms.order.object.image)" style='width:100%;height:150px;object-fit:cover;' />
              </div>

              <div class="order_decoration" :style="controls.styles.themes.active.order_decoration">
                <table border="0" style="width:100%;">
                  <tr>
                    <td>
                      <b>{{ forms.order.object.name | title }}</b><br>
                    </td>

                    <td style="width:80px;text-align:center;background-color:(50,50,50,0.4));">
                      <i class="fas fa-user-clock"></i> <br>
                      <template v-if="forms.order.object.expected_duration">{{ forms.order.object.expected_duration|format_text_duration }}</template>
                      <template v-else><span style="font-size:10px;">Não calculado</span></template>
                    </td>
                  </tr>
                </table>
              </div>

              <div class="modal-body" style='padding-left:30px;padding-right:30px;padding-bottom:28px;padding-top:25px;'>
                <div data-toggle="collapse" href="#product_details_panel" style='cursor:pointer;border-bottom:0.5px solid #ddd;padding-bottom:5px;'>
                  <i class="fas fa-chevron-down" style='font-size:10px;position:relative;top:-1px;'></i>
                  Produto
                  <span style="float:right;padding-right:18px;font-family:arial;">R$ {{ forms.order.object.price }}</span>
                </div>

                <div class="collapse" id="product_details_panel">
                  <table id='product_description' class='table table-sm' style=''>
                    <tr>
                      <td>
                        <template v-if="forms.order.object.product__description">
                          <span style='font-size:14px;'>{{ forms.order.object.product__description | title }}</span><br>
                        </template>
                        <template v-else>Produto sem descrição</template>
                      </td>
                    </tr>
                  </table>
                </div>

                <div style='padding-top:10px;cursor:pointer;border-bottom:0.5px solid #ddd;padding-bottom:5px;' data-toggle="collapse" href="#product_complements_panel">
                  <i class="fas fa-chevron-down" style='font-size:10px;position:relative;top:-1px;'></i> Complementos
                  <span style="float:right;padding-right:18px;font-family:arial;">R$ 12,00</span>
                </div>

                <div class="collapse" id="product_complements_panel">
                  <table id='product_complements' border="0" class='table table-sm table-stripped table-hover' style=''>
                    <tbody>
                      <template v-if='controls.screen.width>=1024'>
                      <template v-for='complement in complements'>
                      <tr>
                        <td>
                          <span style='font-size:14px;'>{{ complement.name }}</span><br>
                          <span style='font-size:10px;color:#888;'>R$ {{ complement.price }}</span>
                        </td>

                        <td style='width:60px;text-align:center;'></td>
                        <td style='width:50px;text-align:center;'>
                          <template v-if='complement.quant > 0'>{{ complement.quant }}</template>
                        </td>

                        <td style='width:60px;text-align:center;'>
                          <template v-if='complement.quant > 0'>{{ complement.price*complement.quant }}</template>
                        </td>

                        <td style='width:40px;'>
                          <span class="fa-stack fa-1x" @click='decrease_complement(complement)' style='cursor:pointer;'>
                            <i class="fas fa-square-full fa-stack-2x"></i>
                            <i class="fa fa-minus fa-stack-1x fa-inverse"></i>
                          </span>
                        </td>

                        <td style='width:20px;padding-top:5px;text-align:center;'>
                          0
                        </td>

                        <td style='width:40px;'>
                          <span class="fa-stack fa-1x" @click='increase_complement(complement)' style='cursor:pointer;'>
                            <i class="fas fa-square-full fa-stack-2x"></i>
                            <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                          </span>
                        </td>
                      </tr>
                      </template>
                      </template>

                      <template v-else>
                      <template v-for='complement in complements'>
                      <tr>
                        <td><span style='font-size:14px;'>{{ complement.name }}</span><br>
                          <span style='font-size:10px;margin-left:1px;font-family:arial;'>R$ {{ complement.price }}</span>
                        </td>

                        <td style='width:50px;text-align:center;'>
                          <template v-if='complement.quant > 0'>{{ complement.quant }}</template>
                        </td>
                        <td style='width:50px;text-align:center;'>
                          <template v-if='complement.quant > 0'>{{ complement.price*complement.quant }}</template>
                        </td>
                        <td style='width:40px;'>
                          <span class="fa-stack fa-1x" @click='decrease_complement(complement)' style='cursor:pointer;'>
                            <i class="fas fa-square-full fa-stack-2x"></i>
                            <i class="fa fa-minus fa-stack-1x fa-inverse"></i>
                          </span>
                        </td>

                        <td style='width:20px;padding-top:5px;text-align:center;'>
                          0
                        </td>

                        <td style='width:40px;'>
                          <span class="fa-stack fa-1x" @click='increase_complement(complement)' style='cursor:pointer;'>
                            <i class="fas fa-square-full fa-stack-2x"></i>
                            <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                          </span>
                        </td>
                      </tr>
                      </template>
                      </template>
                    </tbody>
                  </table>
                </div>

                <div data-toggle="collapse" href="#product_observations_panel" style='padding-top:10px;cursor:pointer;border-bottom:0.5px solid #ddd;padding-bottom:5px;'>
                  <i class="fas fa-chevron-down" style='font-size:10px;position:relative;top:-1px;'></i> Observações
                </div>

                <div class="collapse" id="product_observations_panel" style="padding-top:10px;">
                  <textarea class='form-control' v-model='forms.order.object.observations' placeholder="Observações do pedido.."></textarea>
                </div>

                <div style='padding-top:10px;cursor:pointer;padding-bottom:5px;padding-left:15px;'>
                  <b>Total
                  <span style="float:right;padding-right:18px;font-family:arial;">
                    R$ {{ ( forms.order.object.quantity * forms.order.object.price) | format_money }}
                  </span>
                  </b>
                </div>

                <br>

                <div>
                  <div class="float-left">
                    <div class="float-left">
                      <span style="font-size:10px;padding-left:4px;">Quantidade:</span><br>
                      <select class='form-control form-control-sm' v-model="forms.order.object.quantity">
                        <option value="1.00">1 unidade</option>
                        <option value="2.00">2 unidades</option>
                        <option value="3.00">3 unidades</option>
                        <option value="4.00">4 unidades</option>
                        <option value="5.00">5 unidades</option>
                      </select>
                    </div>
                  </div>

                  <!--<button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal"> X </button>-->
                  <button type="button" class="btn btn-success" @click='save_order()' style="width:120px;line-height:1;margin-top:19px;float:right;font-family:arial;">
                    Confirmar <i class="fas fa-arrow-right"></i>
                  </button>
                </div>
              </div>



              <div class="modal-footer">
                <!--<button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Cancelar</button>->
                <button type="button" class="btn btn-sm btn-success" @click='save_order()' style="font-family:arial;">Confirmar</button>
                -->
              </div>
            </div>
          </div>
        </div>

        <div id="update_command_client_modal" class="modal" tabindex="-1" role="dialog">
          <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h6 class="modal-title">Identificar comanda</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <div class="modal-body" style=''>
                <input class="form-control form-control-sm" v-model="forms.command.change_client_name" placeholder="Informe nome do cliente"/>
                <div class="row">
                  <div class="col-12">
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">-</button>
                1
                <button type="button" class="btn btn-sm btn-secondary" @click=''>+</button>

                <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-sm btn-success" @click=''>
                  R$ 45,00<br>
                  Confirmar
                </button>
              </div>
            </div>
          </div>
        </div>
        {% endverbatim %}
      </div>
    </div>

    {% csrf_token %}
    <script src="{% static 'vali/js/jquery-3.2.1.min.js' %}"></script>
    <script src="{% static 'vali/js/popper.min.js' %}"></script>
    <script src="{% static 'vali/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'bower_components/moment/min/moment.min.js' %}"></script>
    <script async defer src="{% static 'apps/core/authentication/action.js' %}"></script>

    <script>
      var app = new Vue({
        el: '#app',
        mixins: [base_communications],
        data: function() {
          return {
            controls:{
              styles: {
                themes:{
                  active: {
                    'name':'Elegancia',
                    'header':{'background':'#b22222', 'color':'#ffffff'},
                    'header_division':{'border-bottom':'2px solid #b36363'},
                    'order_decoration':{'background-color':'rgba(28, 28, 28, 0.9)'},
                    'product_list':{'background':'#b22222'}
                  },

                  options:[
                    {
                      'name':'Connect',
                      'header':{'background':'#b22222', 'color':'#ffffff'},
                      'header_division':{'border-bottom':'2px solid #b222222'},
                      'order_decoration':{'background-color':'rgba(125, 76, 25, 0.9)'},
                      'product_list':{'background':'rgb(255, 131, 0)'}
                    },

                    {
                      'name':'Elegancia',
                      'header':{'background':'#b22222', 'color':'#ffffff'},
                      'header_division':{'border-bottom':'2px solid #b36363'},
                      'order_decoration':{'background-color':'rgba(28, 28, 28, 0.9)'},
                      'product_list':{'background':'#b22222'}
                    },

                    {
                      'name':'Energia',
                      'header':{'background':'#009000', 'color':'#ffffff'},
                      'header_division':{'border-bottom':'2px solid #2e6b23'},
                      'order_decoration':{'background-color':'rgba(13, 77, 13, 0.9)'},
                      'product_list':{'background':'#009000'}
                    },

                    {
                      'name':'Paz',
                      'header':{'background':'#191f40', 'color':'#ffffff'},
                      'header_division':{'border-bottom':'2px solid #1d2c60'},
                      'order_decoration':{'background-color':'rgba(25, 31, 64, 0.9)'},
                      'product_list':{'background':'#191f40'}
                    },
                  ]
                }
              },

              clock: null,
              screen: {
                width: window.innerWidth,
                height: window.screen.height,
                fullscreen_mode: false,
              },
              urls: {
                groups: '/api/sales/commands/groups/load/',
              }
            },

            forms: {
              command:{
                change_client_name:false,
              },

              search:{
                value: null,
                field: 'name',
                type: 'contains',
              },

              order:{
                object:{
                  command: null,        // = models.ForeignKey(Command, on_delete=models.DO_NOTHING)
                  product: null,        // = models.ForeignKey(Product, on_delete=models.DO_NOTHING)
                  name: null,   //= models.CharField(_('Nome do produto'), max_length=50, null=False, blank=False, unique=False, error_messages=settings.ERRORS_MESSAGES)
                  price: null,  //= models.DecimalField(max_digits=9, decimal_places=2, blank=True, null=True)
                  quantity: null,       //= models.DecimalField(max_digits=5, decimal_places=2, blank=False, null=False, default=1)
                  total: null,          //= models.DecimalField(max_digits=5, decimal_places=2, blank=True, null=True)

                  checkin_time: null,   //= models.DateTimeField(_('Entrada de pedido'), null=True, auto_now_add=True)
                  checkout_time: null,  //= models.DateTimeField(_('Saída de pedido'), null=True, blank=True)
                  waiting_time: null,   //= models.DurationField(null=True, blank=True)
                  implement_time: null, //= models.DurationField(null=True, blank=True)
                  duration_time: null,  //= models.DurationField(null=True, blank=True)
                  status: null,         //= models.CharField(_('Status'), max_length=20, default='WAITING', choices=STATUS_OF_ORDER, null=True, blank=True, error_messages=settings.ERRORS_MESSAGES)
                  observations: null,
                },

                conditions:{},
                backup:{},
                errors:{},
              }

            },

            selected:{
              table_group: 'GERAL',
              table: null,
              table_index: null,

              command: null,
              command_index: null,
              item: null,

              group:null,
              product:null,

              new_product: false,
              new_products: [],

              order: null,
            },

            tables:[
              /*{'id':'1', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'2', 'group':'interno', 'status':'opened', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:20, 'products':[
                {'id':'1', 'code':'10', 'name':'Rodizio', 'price':69.90,'quant':1,'total':69.90, 'is_confirmed':true, 'creation_date':'23/03/2020','creation_time':'20:21:35', 'description':'Rodízio de carnes convencionais e exóticas', 'have_promotion':true, 'show_options':false,'image':'/static/images/commands/entradas.jpg'},
                {'id':'2', 'code':'11', 'name':'Buffet sem churrasco', 'price':35.00, 'quant':1, 'total':69.90, 'is_confirmed':true, 'creation_date':'23/03/2020','creation_time':'20:21:35', 'description':'Self service sem churrasco', 'have_promotion':false, 'show_options':false,'image':'/static/images/commands/refeicao.jpg'},
              ]},
              {'id':'3', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'4', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'5', 'group':'externo', 'status':'opened', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:5, 'products':[]},
              {'id':'6', 'group':'externo', 'status':'opened', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:30, 'products':[]},
              {'id':'7', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'8', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'9', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'10', 'group':'interno', 'status':'opened', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'11', 'group':'externo', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'12', 'group':'externo', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'13', 'group':'interno', 'status':'opened', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'14', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'15', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'16', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'17', 'group':'externo', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'18', 'group':'externo', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'19', 'group':'externo', 'status':'opened', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'20', 'group':'externo', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},*/
            ],

            commands:{},

            complements:[
              {'id':'1', 'name':'Ovo', 'price':1.50, 'quant':0},
              {'id':'1', 'name':'Queijo', 'price':2.00, 'quant':0},
              {'id':'1', 'name':'Presunto', 'price':2.00, 'quant':0},
              {'id':'1', 'name':'Hamburguer', 'price':3.50, 'quant':0},
            ],

            groups: [
              /*{'id':'1', 'code':'1', 'name':'Refeição', 'description':'', 'image':'/static/images/commands/refeicao.jpg',
                'products':[
                  {'id':'1', 'code':'10', 'name':'Rodizio', 'price':69.90, 'description':'Rodízio de carnes convencionais e exóticas', 'have_promotion':true, 'image':'/static/images/commands/entradas.jpg'},
                  {'id':'2', 'code':'11', 'name':'Buffet sem churrasco', 'price':35.00, 'description':'Self service sem churrasco', 'have_promotion':false, 'image':'/static/images/commands/refeicao.jpg'},
                  {'id':'3', 'code':'12', 'name':'Buffet com churrasco', 'price':42.00, 'description':'Self service com churrasco', 'have_promotion':false},
                  {'id':'4', 'code':'13', 'name':'Buffet especial', 'price':69.90, 'description':'Comidas japonesas e arabes, moquecas e tortas especiais', 'have_promotion':true},
                  {'id':'4', 'code':'13', 'name':'Marmitex', 'price':14.00, 'description':'Arroz, feijão, macarrão, duas carnes, farofa, batata frita e salada.', 'have_promotion':true},
                ]
              },


              {'id':'1', 'code':'1', 'name':'Entradas', 'description':'', 'image':'/static/images/commands/entradas.jpg',
                'products':[
                  {'id':'1', 'code':'10', 'name':'Torradas', 'price':8.90, 'description':'250g de torradas amanteigadas com orégano', 'have_promotion':false},
                  {'id':'2', 'code':'11', 'name':'Torresmo', 'price':13.50, 'description':'150g de torresmo', 'have_promotion':false},
                  {'id':'3', 'code':'12', 'name':'Porção de frios', 'price':18.50, 'description':'Salame, ovos de codorna, palmito e queijo em cubinhos', 'have_promotion':false},
                  {'id':'4', 'code':'13', 'name':'Pasteis sortidos', 'price':21.50, 'description':'6 unidades sortidas', 'have_promotion':true},
                ]
              },


              {'id':'2', 'code':'2', 'name':'Porções', 'description':'', 'image':'/static/images/commands/porcoes.jpg',
                'products':[
                  {'id':'5', 'code':'20', 'name':'Pasteis sortidos', 'price':27.50, 'description':'', 'have_promotion':true},
                  {'id':'6', 'code':'21', 'name':'Bolinhas de queijo', 'price':32.80, 'description':'', 'have_promotion':false},
                  {'id':'7', 'code':'22', 'name':'Filé com fritas', 'price':39.90, 'description':'', 'have_promotion':true},
                  {'id':'8', 'code':'23', 'name':'Filé de tilapia', 'price':45.50, 'description':'', 'have_promotion':false},
                ]
              },

              {'id':'3', 'code':'3', 'name':'Pizzas', 'description':'', 'image':'/static/images/commands/pizza.jfif',
                'products':[
                  {'id':'9', 'code':'30', 'name':'Portuguesa', 'price':27.50, 'description':'', 'have_promotion':true},
                  {'id':'10', 'code':'31', 'name':'Calabresa', 'price':33.80, 'description':'', 'have_promotion':false},
                  {'id':'11', 'code':'32', 'name':'Marguerita', 'price':39.90, 'description':'', 'have_promotion':true},
                  {'id':'12', 'code':'33', 'name':'Americana', 'price':45.50, 'description':'', 'have_promotion':false},
                ]
              },

              {'id':'4', 'code':'4', 'name':'Drinks', 'description':'', 'image':'/static/images/commands/drinks.jpg',
                'products':[
                  {'id':'5', 'code':'21', 'name':'Caipivodka', 'price':10.00, 'description':'Vodka batida com limão, açucar e gelo', 'have_promotion':true},
                  {'id':'6', 'code':'22', 'name':'Mad Max', 'price':8.00, 'description':'Vodka com energético', 'have_promotion':true},
                  {'id':'7', 'code':'23', 'name':'Canelinha', 'price':5.00, 'description':'Dose de canelinha', 'have_promotion':false},
                  {'id':'8', 'code':'24', 'name':'Pina colada', 'price':14.50, 'description':'Vodka batida com abacaxi, coco e leite condensado', 'have_promotion':false},
                ]
              },*/
            ],

            user: {},

          }
        },

        filters: {
          round: function(value){
            return value.toFixed(2);
          },

          title(value){
            if(value){
              value = value.toLowerCase().split(' ');
            }
            else{
              value = "";
            }

            let final = [];
            for(let word of value){
              if(word.length > 2){
                final.push(word.charAt(0).toUpperCase()+ word.slice(1));
              }
              else{
                final.push(word);
              }
            }

            return final.join(' ');
          }
        },

        methods: {
          filter_tables: function(option){
            this.selected.table_group = option;
          },

          print_command: function(command){
            window.open("/api/sales/command/"+command.code+"/", "_blank");
          },

          view_order: function(order){
            window.open("/api/sales/commands/order/"+this.selected.order.id+"/", "_blank");
          },

          print_order: function(order){
            let data_paramters = {"order_id":order.id}
            success_function = function(){
              alert("Pedido gerado com sucesso!");
            }

            failure_function = function(){
              alert("Erro! Não foi possivel gerar o pedido")
            }

            this.request('/api/sales/commands/order/print/', "post", data_paramters, null, success_function, failure_function);
          },

          confirm_item: function(item){
            alert("confirmei");
          },

          confirm_new_itens: function(){
            let scope = this;
            for (index in this.selected.new_products) {
              var value = this.selected.new_products[index];
              value.is_confirmed = true;
              this.selected.table.products.unshift(value);
            }
            this.selected.new_products = [];
          },

          show_options: function(command_index , order, order_index){
            if(this.selected.order){
              if(this.selected.order.id==order.id){
                this.selected.table.commands[command_index].orders[order_index].show_options = false;
                this.selected.command_index = null;
                this.selected.order_index = null;
                this.selected.order = null;
              }
              else{
                this.selected.table.commands[command_index].orders[this.selected.order_index].show_options = false;
                this.selected.table.commands[command_index].orders[order_index].show_options = true;
                this.selected.command_index = command_index;
                this.selected.order_index = order_index;
                this.selected.order = order;
              }
            }
            else{
              this.selected.table.commands[command_index].orders[order_index].show_options = true;
              this.selected.command_index = command_index;
              this.selected.order_index = order_index;
              this.selected.order = order;
            }
          },

          open_client_name_field: function(){
            this.forms.command.change_client_name = true;
          },

          confirm_client_name_field: function(){
            this.forms.command.change_client_name = false;
          },

          save_order: function(command, command_index){
            let scope = this;
            let data_paramters = {};
            data_paramters['command_id'] = this.selected.command.id;
            data_paramters['product_id'] = this.selected.product.id;
            data_paramters['name'] = this.selected.product.name;
            data_paramters['image'] = this.selected.product.image;
            data_paramters['price'] = this.selected.product.price;
            data_paramters['quantity'] = this.forms.order.object.quantity;
            data_paramters['total'] = this.selected.product.price*this.forms.order.object.quantity;

            data_paramters['checkin_time'] = null;
            data_paramters['checkout_time'] = null;
            data_paramters['waiting_time'] = null;
            data_paramters['implement_time'] = null;
            data_paramters['duration_time'] = null;
            data_paramters['status'] = null;
            data_paramters['observations'] = this.forms.order.object.observations;

            let success_function = function(response) {
              scope.print_order(response.object);
              response.object.show_options = false;
              scope.selected.command.orders.unshift(response.object);
              //alert("TOTAL DA COMANDA ANTES:"+scope.selected.command.total+" - VALOR A ADICIONAR:"+response.object.total+ " - TOTAL:"+(parseFloat(scope.selected.command.total) + parseFloat(response.object.total)))
              //scope.selected.command.total = parseFloat(scope.selected.command.total) + parseFloat(response.object.total);  //parseFloat(scope.selected.command.total) + parseFloat(response.object.total);
              //alert("TOTAL DA MESA:"+scope.selected.table.total +" - RESPONSE:"+parseFloat(response.object.total))
              scope.selected.table.total = parseFloat(scope.selected.table.total) + parseFloat(response.object.total);
              //alert("somei: "+scope.selected.table.total);
              scope.selected.new_product = null;
              $('#exampleModal').modal('hide');
            };

            let failure_function = function(response) {
              return false;
            };

            this.request('/api/sales/commands/order/save/', "post", data_paramters, null, success_function, failure_function);
          },

          select_item: function(command, item){
            this.selected.command = command;
            this.selected.product = {'id':parseInt(item.product), 'code':'0', 'name':item.name, 'image':item.image, 'price':item.price, 'quantity':1, 'description':'', 'have_promotion':true, 'is_confirmed':false, 'show_options':false};;

            /*this.forms.order.object = {
              command: command.id,
              product: item.id,
              name: item.name,
              price: item.price,
              quantity: 1,
              total: item.price,

              checkin_time: null,
              checkout_time: null,
              waiting_time: null,
              implement_time: null,
              duration_time: null,
              is_confirmed: false,
              show_options: false,
              status: "WAITING",
              observations:"",
            }*/


            //$("#exampleModal").modal();
            //$('#exampleModal').modal('show');

            /*if(item.is_confirmed){
              let new_item = JSON.parse(JSON.stringify(item));
              new_item.quant = 1;
              new_item.is_confirmed = false;
              new_item.show_options = false;
              this.selected.new_products.push(new_item);
            }*/
          },

          unselect_item: function(item){
            this.selected.item = null;
          },

          increase_item: function(index){
            this.selected.table.products[index].quant = this.selected.table.products[index].quant + 1
            //item.quant = item.quant + 1;
            //this.selected.item.quant = this.selected.item.quant + 1;
          },

          decrease_item: function(index){
            if(this.selected.table.products[index].quant >1){
              this.selected.table.products[index].quant = this.selected.table.products[index].quant - 1
            }
            else{
              this.selected.table.products[index].quant = 0
              //this.selected.table.products.shift()
              this.selected.table.products.splice(index,1);
            }
          },

          increase_new_item: function(index){
            this.selected.new_products[index].quant = this.selected.new_products[index].quant + 1
          },

          decrease_new_item: function(index){
            if(this.selected.new_products[index].quant >1){
              this.selected.new_products[index].quant = this.selected.new_products[index].quant - 1
            }
            else{
              this.selected.new_products[index].quant = 0
              //this.selected.table.products.shift()
              this.selected.new_products.splice(index,1);
            }
          },

          verify_screen: function () {
            this.controls.screen.width = window.innerWidth;
            this.controls.screen.height = window.innerHeight;

            let is_mobile = false;
            (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);

            if(!is_mobile){
              if((screen.availHeight || screen.height-30) <= window.innerHeight) {
                this.controls.screen.fullscreen_mode = true;
              } else {
                this.controls.screen.fullscreen_mode = false;
              }
            }
          },

          init_complements: function(){

          },

          back_menu: function(){
            if(this.selected.product){
              $('#exampleModal').modal('hide');
              this.selected.product = null;
              history.pushState(null, document.title, location.href);
            }

            else if(this.selected.group){
              this.selected.group = null;
              history.pushState(null, document.title, location.href);
            }

            else if(this.selected.command){
              this.selected.command = null;
              this.selected.command_index = null;
              this.selected.new_product = false;
              history.pushState(null, document.title, location.href);
            }

            else if(this.selected.table){
              this.selected.table = null;
              history.pushState(null, document.title, location.href);
            }
            else{
              if(confirm("Deseja mesmo sair do sistema?")){
                window.location = "/logout";
              }
            }
            history.pushState(null, document.title, location.href);
          },

          open_menu: function(command, index){
            this.selected.command = command;
            this.selected.new_product = true;
            this.selected.command_index = index;
          },

          repeat_order: function(command, command_index, order){
            let cloned_order = JSON.parse(JSON.stringify(order));
            this.forms.order.object = cloned_order;
            this.selected.product = order;
            //this.selected.command = command;
            //this.selected.new_product = true;
            //this.selected.command_index = command_index;
          },



          load_tables: function () {
            let scope = this;
            let success_function = function(response) {
              scope.tables = response.object;
            };

            let failure_function = function(response) {
              return false;
            };

            this.request('/api/sales/commands/tables/load/', "get", null, null, success_function, failure_function);
          },

          open_table: function (table, index) {
            let scope = this;
            let data_paramters = {'table_id':table.id}

            let success_function = function(response) {
              Vue.set(scope.tables,index,response.object);
              scope.open_command(table, index);
            };

            let failure_function = function(response) {};

            this.request('/api/sales/commands/tables/open/', "post", data_paramters, null, success_function, failure_function);
          },

          close_table: function (table, index) {
            let scope = this;
            let data_paramters = {'table_id':table.id}

            let success_function = function(response) {
              scope.tables[index] = response.object;
            };

            let failure_function = function(response) {

            };

            this.request('/api/sales/commands/table/close/', "post", data_paramters, null, success_function, failure_function);
          },

          select_table: function(table, index){
            let scope = this;
            if(table.status=='CLOSED'){
              if (confirm("Abrir nova comanda na mesa "+table.code)) {
                scope.open_table(table, index);
              }
            }

            else{
              this.selected.table = table;
              this.selected.table_index = index;
            }
          },

          unselect_table: function(table){
            this.selected.table = null;
          },

          open_command: function(table, table_index){
            let scope = this;
            let data_paramters = {'table_id':table.id}

            let success_function = function(response) {
              scope.tables[table_index].commands.push(response.object);
              if(scope.selected.table==null){
                scope.selected.table = scope.tables[table_index];
                scope.selected.table_index = table_index;
              }
            };

            let failure_function = function(response) {
              alert("Erro! Não foi possivel abrir nova comanda")
            };

            this.request('/api/sales/commands/open/', "post", data_paramters, null, success_function, failure_function);
          },

          close_command: function(command, index){
            let scope = this;
            let data_paramters = {'command_id':command.id}

            if(table.status=='CLOSED'){
              if (confirm("Deseja mesmo Encerrar a command "+command.code)) {
                //scope.open_table(table, index);
                //this.open_command(table, index);
                alert("ihh cara.. vc quer encerrar mesmo");

                let success_function = function(response) {
                  scope.tables[index].commands.push(response.object);
                  scope.selected.table = table;
                  scope.selected.table_index = index;
                };

                let failure_function = function(response) {

                };

                //this.request('/api/sales/commands/close/', "post", data_paramters, null, success_function, failure_function);
              }
            }
          },

          load_groups: function () {
            let scope = this;
            let success_function = function(response) {
              scope.groups = response.object;
            };

            let failure_function = function(response) {
              return false;
            };

            this.request('/api/sales/commands/groups/load/', "get", null, null, success_function, failure_function);
          },

          update_clock: function(){
            this.controls.clock = moment().utc().format();
            //this.controls.clock = new Date().utc().format();
          },

          get_user: function () {
            let scope = this;
            let data_parameters = {};
            let success_function = function(response) {
              scope.errors = response.message;
              scope.user = response.object;
              scope.user.password = '';
              alert('OLHA AÊ: ' + JSON.stringify(response));
              //scope.session.is_blocked = response.object.session.is_blocked;
              //localStorage.setItem("is_blocked", response.object.session.is_blocked);
              //scope.controls.page.loaded = true;
            };

            let failure_function = function(response) {
              window.location.href = "/sales/commands/login";
            };

            this.request('/api/core/authentication/get_user/', 'get', data_parameters, null, success_function, failure_function);
          },
        },

        computed: {
          current_time: function(){
            if(this.controls.clock){
              return moment(String(this.controls.clock)).format('HH:mm:ss');
              //return this.controls.clock.format("hh:mm:ss");
            }
          },

          product_in_command: function(){
            let new_array = [];
            this.selected.table.commands.products.forEach(function(item, chave){
              if(item.quant > 0){
                new_array.push(item);
              }
              else{
                alert(item.name+":"+item.quant+"TIRAR");
              }
            });

            console.log("VEJA COMO FICOU ENTAO:"+JSON.stringify(new_array));
            this.selected.table.products = new_array;
            return this.selected.table.products;
          },
        },

        created: function () {
          //this.load_tables();
          //this.init_product_complements();
        },

        mounted: function () {

        }
      });
    </script>

    <script>
      history.pushState(null, document.title, location.href);
      window.addEventListener('popstate', function (event){
        app.back_menu();
      });

    </script>

    <script>
      function success_notify(){

      }

      window.addEventListener('load', function () {
        app.get_user();
        app.load_tables();
        app.load_groups();
        register_action();
      }, false);

      window.addEventListener('resize', function(e) {
        app.verify_screen();
      });

      var clock = setInterval(function(){app.update_clock()},1000);
    </script>
  </body>
</html>