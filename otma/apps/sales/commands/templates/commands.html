<!DOCTYPE html>
<html lang="pt-br" xmlns:script="http://www.w3.org/1999/html">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Melinux - Controle de comandas</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'bower_components/bootstrap/dist/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'bower_components/font-awesome/css/all.min.css' %}">

    <script src="{% static 'bower_components/vue/dist/vue.js' %}"></script>
    <script src="{% static 'base_controller.js' %}"></script>
    <script src="{% static 'commands_controller.js' %}"></script>

    <style>
      /*
        AUTO GRID
        Set the minimum item size with `--auto-grid-min-size` and you'll
        get a fully responsive grid with no media queries.
      */

      .auto-grid-large {
        --auto-grid-min-size: 14rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
        grid-gap: 1rem;
      }

      .auto-grid-small {
        --auto-grid-min-size: 6rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
        grid-gap: 1rem;
      }

      #table-panel .auto-grid-large {
        --auto-grid-min-size: 8rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
        grid-gap: 1rem;
      }

      #table-panel .auto-grid-small {
        --auto-grid-min-size: 4rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
        grid-gap: 1rem;
      }

      /* Presentational styles */
      body {
        background-image: url("/static/apps/sales/commands/images/background-sm.png");
        line-height: 1.4;
        font-family: Tahoma, Geneva, sans-serif;
      }

      #table-panel li {
        text-align: left;
        background: #ccc;
        color: #ffffff;
      }

      #table-panel li.opened {
        background: #6b8e23;
      }

      #table-panel li.waiting {
        background: #e38e00;
      }

      #consumed_products td {
        padding:10px;
      }


      ul #product-menu{
        list-style-type: none;
      }

      ul#product-menu li {
        text-align: left;
        background: rgb(178,34,34);
        background: linear-gradient(0deg, rgba(178,34,34,1) 0%, rgba(178,34,34,1) 92%, rgba(134,28,28,1) 100%);
        color: #ffffff;
      }

      ul#product-menu li span {
        position: relative;
        left:4px;
        top: 4px;
      }

      ul#product-menu li:hover {
        background: #8e1b1b;
      }

      .auto-grid-small {
        font-size: 9px;
      }

      .auto-grid-large {
        font-size: 1.0rem;
      }

      .menu-item-image{
        object-fit:cover;
        width:100%;
        height:155px;
      }

      .auto-grid-small .menu-item-image{
        height:70px;
      }

      .menu-item-price{
        border-bottom-left-radius: 5px;
        text-align: right;
        color: #b22222;
        height: 20px;
        float: right;
      }

      .auto-grid-large .menu-item-price{
        padding-left:20px;
        padding-top: 0px;
        margin-top:-155px;
        font-size:14px;
      }

      .auto-grid-small .menu-item-price{
        padding-left:15px;
        margin-top:-73px;
        padding-top:3px;
        font-size:11px;
      }

      #product_complements, #product_description {
        font-size:12px;
      }

      #product_complements thead tr td{
        font-size:10px;
        border-top: none;
      }

      #product_complements td, #product_description td{
        vertical-align:middle;
      }

    </style>
  </head>

  <body>
    <div style='padding:0px;'>

      <div id="app" @mousemove="" @keyup="">
        <div style='background:#b22222;color: white;'>
          {% verbatim %}
          <div style="border-bottom: 2px solid #b36363;">
            <table border='0' style="width:100%;">
              <tr>


                <td style="padding-left:10px;text-align:left;font-family:Brush Script MT, Brush Script Std, cursive;font-size:30px;">Madero</td>

                <td style="width:40px;">
                  <span v-if="selected.table!=null" @click="selected.table=null" style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;">
                    <i class="fas fa-arrow-left"></i>
                  </span>
                </td>

                <td style="width:40px;">
                  <span style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;">
                    <i class="fas fa-bell"></i>
                  </span>
                </td>

                <td v-if="selected.table==null" style="width:40px;">
                  <div class="dropdown">
                    <span class="" id="dropdownMenuButton" title="Filtrar mesas" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;">
                      <i class="fas fa-filter"></i>
                    </span>

                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="font-size:12px;">
                      <a class="dropdown-item" href="#" @click="selected.table_group='INTERNA'" style="padding-right:10px;">
                        Mesas internas <i v-if="selected.table_group=='INTERNA'" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                      </a>

                      <a class="dropdown-item" href="#" @click="selected.table_group='EXTERNA'" style="padding-right:10px;">
                        Mesas externas <i v-if="selected.table_group=='EXTERNA'" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                      </a>
                      <a class="dropdown-item" href="#" @click="selected.table_group='WAITING'" style="padding-right:10px;">
                        Mesas aguardando <i v-if="selected.table_group=='WAITING'" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                      </a>

                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" href="#" @click="selected.table_group='GERAL'" style="padding-right:10px;">
                        Todas as mesas <i v-if="selected.table_group=='GERAL'" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                      </a>
                    </div>
                  </div>
                </td>


                <td style="width:40px;">
                  <div class="dropdown">
                    <span class="" style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fas fa-user"></i>
                    </span>

                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <a class="dropdown-item" href="#">Coisas</a>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" href="#">Another action</a>
                      <a class="dropdown-item" href="#">Sair</a>
                    </div>
                  </div>
                </td>
              </tr>
            </table>
          </div>

          {% endverbatim %}
        </div>

        {% verbatim %}
        <div style="padding:15px;">
          <template v-if="selected.new_product">
            <app_commands :controls="controls" :selected="selected" :groups="groups" :complements="complements" :init_complements="init_complements" :new_products="selected.new_products">

            </app_commands>
          </template>

          <div v-else-if='selected.table==null' id="table-panel">
            <ul id='tables-list' :class="{'auto-grid-small':controls.screen.width<1024, 'auto-grid-large':controls.screen.width>=1024}" style='margin-left:-40px;'>
              <template v-for='(table, table_index) in tables'>
                <li v-if="table.area==selected.table_group || table.status==selected.table_group || selected.table_group=='GERAL'" @click="select_table(table, table_index)" :class="{'opened':table.status=='ACTIVE', 'waiting':table.status=='WAITING'}" style='vertical-align:middle;padding:5px;cursor:pointer;padding-bottom:10px;padding-top:10px;line-height:15px;'>
                  <div style="text-align:center;">
                    <i v-if="table.status=='WAITING'" class="fas fa-user-clock fa-3x"></i>
                    <i v-else-if="table.status=='ACTIVE'" class="fas fa-users fa-3x"></i>
                    <i v-else class="fas fa-users fa-3x"></i>
                    <br>
                    <span style="position:relative;top:4px;">Mesa {{ table.code }}</span><br>
                    <span style="font-size:10px;">{{ table.area }}</span>
                  </div>
                </li>
              </template>
            </ul>
          </div>

          <div class="" v-else style="height: calc(100vh - 150px);">
            <!-- ESSE TRECHO DE CÓDIGO SERVE PARA CRIARMOS UMA LISTA SEPARADA DE ITENS, PRA CONFIRMAR
                 TODOS DE UMA SÓ VEZ, POR ENQUANTO NÃO VAMOS USA-LA MAS VAMOS DEIXAR AQUI PRA AVALIAR
                 ISSO COM CALMA.

            <div v-if="selected.new_products.length > 0" style="background:white;width:100%;padding:10px;border:1px solid #ddd;margin-bottom:15px;">
              <div style="height:36px;">
                <h6 class="float-left" style="position:relative;top:3px;"><i class="far fa-file-alt"></i> Novo pedido</h6>
                <div class="float-right">
                  <button class="btn btn-sm btn-success" style="font-size:10px;" @click="confirm_new_itens()">Confirmar</button>
                </div>
              </div>


              {{ selected.new_products }}

              <table class="table table-sm" border="0" style='width:100%;'>
                <tr v-for='(order,index) in selected.new_products'>
                  <td style="line-height:10px;padding:10px;">
                    <span style='font-size:14px;'>{{ order.product_name }}</span><br>
                    <span style='font-size:12px;color:#888;position:relative;top:2px;'>
                      {{ order.quantity }} x {{ order.product_price}}
                    </span>
                  </td>

                  <td style='width:40px;padding:0px;vertical-align:middle;'>
                    <span class="fa-stack fa-1x" @click='decrease_new_item(index)' style='cursor:pointer;font-size:12px;'>
                      <i class="fas fa-square-full fa-stack-2x"></i>
                      <i class="fa fa-minus fa-stack-1x fa-inverse"></i>
                    </span>
                  </td>

                  <td style='width:40px;padding:0px;vertical-align:middle;'>
                    <span class="fa-stack fa-1x" @click='increase_new_item(index)' style='cursor:pointer;font-size:12px;'>
                      <i class="fas fa-square-full fa-stack-2x"></i>
                      <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                    </span>
                  </td>
                </tr>
              </table>
            </div>-->

            <template v-if="selected.table.commands.length==0">
              Nenhuma comanda aberta.. clique aqui para abrir nova comanda
            </template>

            <template v-else v-for="(command,command_index) in selected.table.commands">
              <div id="consumed_products_panel" style="background:white;padding:10px;border:1px solid #eee;">
                <div style="height:50px;padding-bottom:40px;border-bottom:1px solid #ddd;">
                  <h6 class="float-left" style="position:relative;top:3px;">
                    <i class="fas fa-tasks"></i> Comanda {{ command.code }} - <span>{{ command.status }}</span><br>
                    <span style="font-size:12px;color:#666;">Entrada: {{ command.checkin_time | format_datetime }}</span>
                  </h6>

                  <div class="float-right" style="position:relative;top:0px;padding-right:0px;">
                    <button type="button" class="btn btn-sm btn-light" @click="print_command(command)" style="line-height:1;height:38px;"><i class="fas fa-print"></i><br><span style="font-size:10px;">Imprimir</span></button>
                    <button type="button" class="btn btn-sm btn-light" @click="open_menu(selected.table.commands[0], command_index)" style="line-height:1;height:38px;"><i class="fas fa-plus"></i><br><span style="font-size:10px;">Adicionar</span></button>
                    <!--<button type="button" class="btn btn-sm btn-secondary" style="line-height:1;width:110px;height:38px;"><span style="font-size:13px;font-weight:bold;">R$ {{ command.total }}</span><br><span style="font-size:10px;"><i class="fas fa-sign-out-alt"></i> Encerrar</span></button>-->

                    <div class="btn-group">
                      <button type="button" class="btn btn-sm btn-secondary" style="line-height:1;width:125px;height:38px;" @click="close_command(command)"><span style="font-weight:bold;font-size:15px;">R$ {{ command.total }}</span><br><span style="font-size:10px;"><i class="fas fa-sign-out-alt"></i> Encerrar</span></button>
                      <template v-if="command.total>0">
                      <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="sr-only">Toggle Dropdown</span>
                      </button>
                      <div class="dropdown-menu">
                        <a class="dropdown-item" href="#">Para 2 pessoas <span class="float-right">R$ {{ command.total/2 | round }}</span></a>
                        <a class="dropdown-item" href="#">Para 3 pessoas <span class="float-right">R$ {{ command.total/3 | round }}</span></a>
                        <a class="dropdown-item" href="#">Para 4 pessoas <span class="float-right">R$ {{ command.total/4 | round }}</span></a>
                        <a class="dropdown-item" href="#">Para 5 pessoas <span class="float-right">R$ {{ command.total/5 | round }}</span></a>
                        <a class="dropdown-item" href="#">Para 6 pessoas <span class="float-right">R$ {{ command.total/6 | round }}</span></a>

                        <template v-if="command.total >= 300">
                        <a class="dropdown-item" href="#">Para 7 pessoas <span class="float-right">R$ {{ command.total/7 | round }}</span></a>
                        <a class="dropdown-item" href="#">Para 8 pessoas <span class="float-right">R$ {{ command.total/8 | round }}</span></a>
                        <a class="dropdown-item" href="#">Para 9 pessoas <span class="float-right">R$ {{ command.total/9 | round }}</span></a>
                        <a class="dropdown-item" href="#">Para 10 pessoas <span class="float-right">R$ {{ command.total/10 | round }}</span></a>
                        </template>

                        <template v-if="command.total >= 500">
                        <a class="dropdown-item" href="#">Para 11 pessoas R$ {{ command.total/11 | round }}</a>
                        <a class="dropdown-item" href="#">Para 12 pessoas R$ {{ command.total/12 | round }}</a>
                        <a class="dropdown-item" href="#">Para 13 pessoas R$ {{ command.total/13 | round }}</a>
                        <a class="dropdown-item" href="#">Para 14 pessoas R$ {{ command.total/14 | round }}</a>
                        <a class="dropdown-item" href="#">Para 15 pessoas R$ {{ command.total/15 | round }}</a>
                        </template>
                      </div>
                      </template>
                    </div>
                  </div>
                </div>

                <br>

                <table border="0" id='consumed_products' class='table table-sm table-stripped table-hover' style='margin-bottom:0px;'>
                  <template v-if='controls.screen.width>=1024'>
                    <thead>
                      <tr style="font-size:10px;font-weight:bold;font-weight:bold;">
                        <td style="text-align:left;border-top:none;">Produto</td>
                        <td style="text-align:center;border-top:none;"></td>
                        <td style="text-align:center;border-top:none;"></td>
                        <td style="text-align:center;border-top:none;">Quant</td>
                        <td style="text-align:center;border-top:none;">Preço</td>
                        <td style="text-align:center;border-top:none;">Total</td>
                      </tr>
                    </thead>

                    <tbody>
                      <template v-for='(order,order_index) in command.orders'>
                      <tr style="cursor:pointer;" @click="show_options(order)"><!-- data-toggle="modal" data-target="#command_item_options" -->
                        <td style="width:100px;">
                          <img :src="'/media/'+order.product_image" style='width:90px;height:60px;object-fit:cover;' />
                        </td>

                        <td style="line-height:1.1;">
                          <span style='font-size:18px;'>{{ order.product_name }}</span><br>
                          <span style='font-size:12px;color:#888;'>Entrada: {{ order.checkin_time | format_time }} -
                          <template v-if="order.checkout_time==null">Previsão: {{ order.expected_time | format_time }}</template>
                          <template v-else>Entrega: {{ order.checkout_time | format_time }}</template></span>
                          <br>
                          <span style='font-size:12px;color:#888;'>Observações: {{ order.observations }}</span>
                        </td>

                        <template v-if="order.show_options==false">
                        <td style='width:40px;vertical-align:middle;text-align:center;'>
                          <template v-if="order.status=='WAITING'">
                            AGUARDANDO
                          </template>

                          <template v-else-if="order.status=='IN_PROGRESS'">
                            ANDAMENTO
                          </template>

                          <template v-else-if="order.status=='READY'">
                            PRONTO
                          </template>

                          <template v-else-if="order.status=='CANCELED'">
                            CANCELADO
                          </template>

                          <template v-else>
                            ENTREGUE
                          </template>

                          <template v-if="(controls.clock > order.expected_time) && (order.status=='WAITING' || order.status!='IN_PROGRESS' || order.status!='READY')">
                            <span style="color:red;font-size:12px;"><b>ATRASADO</b></span>
                          </template>
                        </td>

                        <td style='width:110px;text-align:center;vertical-align:middle;'>
                          <span style='font-size:18px;'>{{ order.quantity }}</span>
                        </td>

                        <td style="vertical-align:middle;text-align:center;width:110px;">
                          <span style='font-size:18px;'>R$ {{ order.product_price }}</span>
                        </td>

                        <td style='width:110px;text-align:center;vertical-align:middle;'>
                          <span style='font-size:18px;'>R$ {{ order.total }}</span>
                        </td>
                        </template>

                        <template v-else>
                        <td colspan="4" style="vertical-align:middle;">
                          <div class="float-right">
                          <button class="btn btn-sm btn-secondary" @click="print_order(order)"><i class="fas fa-search"></i><br>Visualizar</button>
                          <button class="btn btn-sm btn-secondary"><i class="fas fa-redo-alt"></i><br>Repetir</button>
                          <button class="btn btn-sm btn-danger" :disabled="(order.status=='READY') || (order.status=='CLOSED') || (order.status=='CANCELED')"><i class="fas fa-times"></i><br>Cancelar</button>
                          </div>
                        </td>
                        <!--<td style='width:40px;vertical-align:middle;'>
                          <span class="fa-stack fa-1x" style='cursor:pointer;'>
                            <i class="fas fa-square-full fa-stack-2x"></i>
                            <i class="fas fa-exclamation-triangle fa-stack-1x fa-inverse"></i>
                          </span>
                        </td>

                        <td style='width:40px;vertical-align:middle;'>
                          <a @click="select_item(command, order)" data-toggle="modal" data-target="#exampleModal">
                          <span class="fa-stack fa-1x" style='cursor:pointer;'>
                            <i class="fas fa-square-full fa-stack-2x"></i>
                            <i class="fas fa-redo fa-stack-1x fa-inverse"></i>
                          </span>
                          </a>
                        </td>-->
                        </template>
                      </tr>
                      </template>
                      <!--<tr style="font-weight:bold;">
                        <td colspan="5">Total</td>
                        <td colspan="2">R$ 280,00</td>
                      </tr>-->
                    </tbody>
                  </template>

                  <template v-else>
                    <tbody>
                      <template v-for='(order,index) in command.orders'>
                        <tr>
                          <!--<td style="width:90px;padding-left:0px;"><img :src="'/media/'+order.product_image" style="object-fit:cover;width:100%;height:50px;"></td>-->
                          <td @click="show_options(order)" style="padding-top:4px;padding-bottom:10px;line-height:1;">
                            <span style="font-size:14px;">{{ order.quantity }} x {{ order.product_name }}</span><br>
                            <!--<span style='font-size:12px;color:#888;position:relative;top:2px;'>
                              {{ order.quantity }} x {{ order.product_price }}
                            </span>-->
                            <span style='font-size:12px;color:#888;position:relative;top:2px;'>
                              <span style="padding-right:8px;"><i class="fas fa-arrow-up" style=""></i> {{ order.checkin_time | format_time }}</span>

                              <span style="padding-right:8px;"><template v-if="order.checkout==null"><i class="fas fa-arrow-down"></i> {{ order.expected_time | format_time }}</template>
                              <template v-else><i class="fas fa-arrow-down" style="color:green;"> {{ order.checkout | format_time }}</i></template></span>

                              <span style="">
                                <template v-if="(controls.clock > order.expected_time) && (order.status=='WAITING' || order.status!='IN_PROGRESS' || order.status!='READY')">
                                  <span style="color:#a60e0e;font-size:12px;">ATRASADO</span>
                                </template>
                              </span>
                            </span>
                          </td>

                          <td style="text-align:right;">
                            <template v-if="order.show_options">
                              <span class="fa-stack fa-1x" style='cursor:pointer;font-size:12px;' title="Cancelar pedido">
                                <i class="fas fa-square-full fa-stack-2x"></i>
                                <i class="fas fa-exclamation-triangle fa-stack-1x fa-inverse"></i>
                              </span>

                              <span class="fa-stack fa-1x" @click='select_item(order)' style='cursor:pointer;font-size:12px;' title="Repetir o pedido">
                                <i class="fas fa-square-full fa-stack-2x"></i>
                                <i class="fas fa-redo fa-stack-1x fa-inverse"></i>
                              </span>
                            </template>

                            <template v-else style=''>
                              <div @click="show_options(order)">{{ order.total }}</div>
                            </template>
                          </td>
                        </tr>
                      </template>

                      <!--<template v-for='(product,index) in product_in_command'>
                        <tr style="cursor:pointer;" @click="show_options(product)"><!- product_in_command data-toggle="modal" data-target="#command_item_options"  ->
                          <td style="line-height:10px;">
                            <span style='font-size:14px;font-weight:bold;'>{{ product.name }}</span><br>
                            <span style='font-size:12px;color:#888;position:relative;top:2px;'>
                              {{ product.quant }} x {{ product.price}}
                            </span>
                          </td>

                          <td style='width:40px;padding:0px;vertical-align:middle;'>
                            <template v-if="product.show_options">
                            <span class="fa-stack fa-1x" style='cursor:pointer;font-size:12px;' title="Cancelar pedido">
                              <i class="fas fa-square-full fa-stack-2x"></i>
                              <i class="fas fa-exclamation-triangle fa-stack-1x fa-inverse"></i>
                            </span>
                            </template>
                          </td>

                          <td style='width:40px;padding:0px;vertical-align:middle;font-size:12px;'>
                            <template v-if="product.show_options">
                              <span class="fa-stack fa-1x" @click='select_item(product)' style='cursor:pointer;font-size:12px;' title="Repetir o pedido">
                                <i class="fas fa-square-full fa-stack-2x"></i>
                                <i class="fas fa-redo fa-stack-1x fa-inverse"></i>
                              </span>
                            </template>

                            <template v-else style=''>146,00</template>
                          </td>
                        </tr>
                      </template>
                      -->

                      <!--<tr>
                        <td style="line-height:10px;vertical-align:middle;">
                          <span style='font-size:14px;font-weight:bold;'>Total</span>
                        </td>

                        <td style=padding:0px;'width:40px;text-align:center;vertical-align:middle;'>
                          <span style='font-size:12px;font-weight:bold;'>R$ 292,00</span>
                        </td>
                      </tr>-->
                    </tbody>
                  </template>
                </table>
              </div>
              <br>
            </template>
          </div>
        </div>

        <div id="exampleModal" class="modal" tabindex="-1" role="dialog">
          <div class="modal-dialog modal-lg" role="document">
            <div v-if='selected.product ' class="modal-content">
              <div class="modal-header" style='padding:0px;'>
                <img :src="'/media/'+selected.product.image" style='width:100%;height:150px;object-fit:cover;' />
              </div>

              <span style='position:relative;top:-44px;left:-10px;padding:10px;'>
                <span style='padding:10px;color:white;font-size:18px;font-weight:bold;background:#888;border-top-right-radius:5px;'>
                {{ selected.product.name }}
                </span>
              </span>

              <div class="modal-body" style='margin-top:-30px;'>
                <table border='0' id='product_description' class='table table-sm' style=''>
                  <tr>
                    <td>
                      <span style='font-size:14px;'>{{ selected.product.name }}</span><br>
                      <span style='font-size:10px;color:#888;'>{{ selected.product.description }}</span>
                    </td>

                    <td>
                      <input class='form-control-sm' v-model='forms.order.object.quantity' type='number' value="1" />
                    </td>

                    <td>
                      {{ selected.product.price }}
                    </td>
                  </tr>
                </table>

                <!--<table border='0' id='product_description' class='table table-sm table-stripped table-hover' style=''>
                  <tr>
                    <td>
                      <span style='font-size:14px;'>{{ selected.product.name }}</span><br>
                      <span style='font-size:10px;color:#888;'>{{ selected.product.description }}</span>
                    </td>

                    <td style='width:40px;'>
                      <span class="fa-stack fa-1x" @click='decrease_complement(extra)' style='cursor:pointer;'>
                        <i class="fas fa-square-full fa-stack-2x"></i>
                        <i class="fa fa-minus fa-stack-1x fa-inverse"></i>
                      </span>
                    </td>

                    <td style='width:40px;'>
                      <span class="fa-stack fa-1x" @click='increase_complement(extra)' style='cursor:pointer;'>
                        <i class="fas fa-square-full fa-stack-2x"></i>
                        <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                      </span>
                    </td>
                  </tr>

                  <tr>
                    <td>
                      <span style='font-size:14px;'>{{ selected.product.name }} P</span><br>
                      <span style='font-size:10px;color:#888;'>{{ selected.product.description }}</span>
                    </td>

                    <td style='width:40px;'>
                      <span class="fa-stack fa-1x" @click='decrease_complement(extra)' style='cursor:pointer;'>
                        <i class="fas fa-square-full fa-stack-2x"></i>
                        <i class="fa fa-minus fa-stack-1x fa-inverse"></i>
                      </span>
                    </td>

                    <td style='width:40px;'>
                      <span class="fa-stack fa-1x" @click='increase_complement(extra)' style='cursor:pointer;'>
                        <i class="fas fa-square-full fa-stack-2x"></i>
                        <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                      </span>
                    </td>
                  </tr>

                  <tr>
                    <td>
                      <span style='font-size:14px;'>{{ selected.product.name }} M</span><br>
                      <span style='font-size:10px;color:#888;'>{{ selected.product.description }}</span>
                    </td>

                    <td style='width:40px;'>
                      <span class="fa-stack fa-1x" @click='decrease_complement(extra)' style='cursor:pointer;'>
                        <i class="fas fa-square-full fa-stack-2x"></i>
                        <i class="fa fa-minus fa-stack-1x fa-inverse"></i>
                      </span>
                    </td>

                    <td style='width:40px;'>
                      <span class="fa-stack fa-1x" @click='increase_complement(extra)' style='cursor:pointer;'>
                        <i class="fas fa-square-full fa-stack-2x"></i>
                        <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                      </span>
                    </td>
                  </tr>

                  <tr>
                    <td>
                      <span style='font-size:14px;'>{{ selected.product.name }} G</span><br>
                      <span style='font-size:10px;color:#888;'>{{ selected.product.description }}</span>
                    </td>

                    <td style='width:40px;'>
                      <span class="fa-stack fa-1x" @click='decrease_complement(extra)' style='cursor:pointer;'>
                        <i class="fas fa-square-full fa-stack-2x"></i>
                        <i class="fa fa-minus fa-stack-1x fa-inverse"></i>
                      </span>
                    </td>

                    <td style='width:40px;'>
                      <span class="fa-stack fa-1x" @click='increase_complement(extra)' style='cursor:pointer;'>
                        <i class="fas fa-square-full fa-stack-2x"></i>
                        <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                      </span>
                    </td>
                  </tr>
                </table>-->
                <br>
               <!-- <table border='1' id='product_options' class='table table-sm table-stripped table-hover' style=''>
                  <tbody>
                    <tr>
                      <td>
                        <span style='font-size:14px;'>Tamanho</span>
                        <span style='font-size:10px;color:#888;'> - R$ {{ selected.product.price }}</span>
                      </td>

                      <td style='width:60px;text-align:center;'></td>
                      <td style='width:50px;text-align:center;'>
                        <template v-if='selected.product.quant > 0'>{{ selected.product.price }}</template>
                      </td>
                      <td style='width:60px;text-align:center;'>
                        <template v-if='selected.product.quant > 0'>{{ selected.product.price }}</template>
                      </td>

                      <td style='width:40px;'>
                        <span class="fa-stack fa-1x"  style='cursor:pointer;'>
                          <i class="fas fa-square-full fa-stack-2x"></i>
                          <i class="fa-stack-1x fa-inverse" style='font-style:normal;'>P</i>
                        </span>
                      </td>

                      <td style='width:40px;'>
                        <span class="fa-stack fa-1x"  style='cursor:pointer;'>
                          <i class="fas fa-square-full fa-stack-2x"></i>
                          <i class="fa-stack-1x fa-inverse" style='font-style:normal;'>M</i>
                        </span>
                      </td>

                      <td style='width:40px;'>
                        <span class="fa-stack fa-1x"  style='cursor:pointer;'>
                          <i class="fas fa-square-full fa-stack-2x"></i>
                          <i class="fa-stack-1x fa-inverse" style='font-style:normal;'>G</i>
                        </span>
                      </td>

                      <td style='width:40px;'>
                        <span class="fa-stack fa-1x"  style='cursor:pointer;'>
                          <i class="fas fa-square-full fa-stack-2x"></i>
                          <i class="fa fa-minus fa-stack-1x fa-inverse"></i>
                        </span>
                      </td>

                      <td style='width:40px;'>
                        <span class="fa-stack fa-1x"  style='cursor:pointer;'>
                          <i class="fas fa-square-full fa-stack-2x"></i>
                          <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                        </span>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <br>
                -->

                <div style='cursor:pointer;border-bottom:0.5px solid #ddd;padding-bottom:5px;' data-toggle="collapse" href="#product_complements_panel">
                  Complementos <i class="fas fa-chevron-down" style='font-size:11px;position:relative;top:-1px;left:5px;'></i>
                </div>

                <div class="collapse" id="product_complements_panel">
                  <table id='product_complements' class='table table-sm table-stripped table-hover' style=''>
                    <tbody>
                      <template v-if='controls.screen.width>=1024'>
                      <template v-for='complement in complements'>
                      <tr>
                        <td>
                          <span style='font-size:14px;'>{{ complement.name }}</span><br>
                          <span style='font-size:10px;color:#888;'>R$ {{ complement.price }}</span>
                        </td>

                        <td style='width:60px;text-align:center;'></td>
                        <td style='width:50px;text-align:center;'>
                          <template v-if='complement.quant > 0'>{{ complement.quant }}</template>
                        </td>
                        <td style='width:60px;text-align:center;'>
                          <template v-if='complement.quant > 0'>{{ complement.price*complement.quant }}</template>
                        </td>
                        <td style='width:40px;'>
                          <span class="fa-stack fa-1x" @click='decrease_complement(complement)' style='cursor:pointer;'>
                            <i class="fas fa-square-full fa-stack-2x"></i>
                            <i class="fa fa-minus fa-stack-1x fa-inverse"></i>
                          </span>
                        </td>

                        <td style='width:40px;'>
                          <span class="fa-stack fa-1x" @click='increase_complement(complement)' style='cursor:pointer;'>
                            <i class="fas fa-square-full fa-stack-2x"></i>
                            <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                          </span>
                        </td>
                      </tr>
                      </template>
                      </template>

                      <template v-else>
                      <template v-for='complement in complements'>
                      <tr>
                        <td><span style='font-size:14px;'>{{ complement.name }}</span><br>
                          <span style='font-size:10px;margin-left:1px;'>R$ {{ complement.price }}</span>
                        </td>

                        <td style='width:50px;text-align:center;'>
                          <template v-if='complement.quant > 0'>{{ complement.quant }}</template>
                        </td>
                        <td style='width:50px;text-align:center;'>
                          <template v-if='complement.quant > 0'>{{ complement.price*complement.quant }}</template>
                        </td>
                        <td style='width:40px;'>
                          <span class="fa-stack fa-1x" @click='decrease_complement(complement)' style='cursor:pointer;'>
                            <i class="fas fa-square-full fa-stack-2x"></i>
                            <i class="fa fa-minus fa-stack-1x fa-inverse"></i>
                          </span>
                        </td>

                        <td style='width:40px;'>
                          <span class="fa-stack fa-1x" @click='increase_complement(complement)' style='cursor:pointer;'>
                            <i class="fas fa-square-full fa-stack-2x"></i>
                            <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                          </span>
                        </td>
                      </tr>
                      </template>
                      </template>
                    </tbody>
                  </table>
                </div>

                <br>

                <div class='row'>
                  <div class='col-12'>
                    <div style='cursor:pointer;border-bottom:0.5px solid #ddd;padding-bottom:5px;'>
                      Observações
                    </div>
                    <textarea class='form-control' v-model='forms.order.object.observations'></textarea>
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-sm btn-success" @click='save_order()'>Adicionar</button>
              </div>
            </div>
          </div>
        </div>
        {% endverbatim %}
      </div>
    </div>



    <!--<div id="exampleModal3" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document">
        <div v-if='selected.product' class="modal-content">
          <div class="modal-header" style='padding:0px;'>
            <img :src="selected.product.image" style='width:100%;height:150px;object-fit:cover;' />
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

          <span style='position:relative;top:-44px;left:-10px;padding:10px;'>
            <span style='padding:10px;color:white;font-size:18px;font-weight:bold;background:#888;border-top-right-radius:5px;'>
            {{ selected.product.name }}
            </span>
          </span>

          <div class="modal-body" style='margin-top:-30px;'>


          </div>

          <div class="modal-footer">

          </div>
        </div>
      </div>
    </div>-->

    {% csrf_token %}
    <script src="{% static 'vali/js/jquery-3.2.1.min.js' %}"></script>
    <script src="{% static 'vali/js/popper.min.js' %}"></script>
    <script src="{% static 'vali/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'bower_components/moment/min/moment.min.js' %}"></script>
    <script async defer src="{% static 'apps/core/authentication/action.js' %}"></script>

    <script>
      var app = new Vue({
        el: '#app',
        mixins: [base_communications],
        data: function() {
          return {
            controls:{
              clock: null,
              screen: {
                width: window.innerWidth,
                height: window.screen.height,
              },
              urls: {
                groups: '/api/sales/commands/groups/load/',
              }
            },

            forms: {
              search:{
                value: null,
                field: 'name',
                type: 'contains',
              },


              order:{
                object:{
                  command: null,        // = models.ForeignKey(Command, on_delete=models.DO_NOTHING)
                  product: null,        // = models.ForeignKey(Product, on_delete=models.DO_NOTHING)
                  product_name: null,   //= models.CharField(_('Nome do produto'), max_length=50, null=False, blank=False, unique=False, error_messages=settings.ERRORS_MESSAGES)
                  product_price: null,  //= models.DecimalField(max_digits=9, decimal_places=2, blank=True, null=True)
                  quantity: null,       //= models.DecimalField(max_digits=5, decimal_places=2, blank=False, null=False, default=1)
                  total: null,          //= models.DecimalField(max_digits=5, decimal_places=2, blank=True, null=True)

                  checkin_time: null,   //= models.DateTimeField(_('Entrada de pedido'), null=True, auto_now_add=True)
                  checkout_time: null,  //= models.DateTimeField(_('Saída de pedido'), null=True, blank=True)
                  waiting_time: null,   //= models.DurationField(null=True, blank=True)
                  implement_time: null, //= models.DurationField(null=True, blank=True)
                  duration_time: null,  //= models.DurationField(null=True, blank=True)
                  status: null,         //= models.CharField(_('Status'), max_length=20, default='WAITING', choices=STATUS_OF_ORDER, null=True, blank=True, error_messages=settings.ERRORS_MESSAGES)
                  observations: null,
                },

                conditions:{},
                backup:{},
                errors:{},
              }

            },

            selected:{
              table_group: 'GERAL',
              table: null,
              table_index: null,

              command: null,
              item: null,

              group:null,
              product:null,

              new_product: false,
              new_products: [],
            },

            tables:[
              /*{'id':'1', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'2', 'group':'interno', 'status':'opened', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:20, 'products':[
                {'id':'1', 'code':'10', 'name':'Rodizio', 'price':69.90,'quant':1,'total':69.90, 'is_confirmed':true, 'creation_date':'23/03/2020','creation_time':'20:21:35', 'description':'Rodízio de carnes convencionais e exóticas', 'have_promotion':true, 'show_options':false,'image':'/static/images/commands/entradas.jpg'},
                {'id':'2', 'code':'11', 'name':'Buffet sem churrasco', 'price':35.00, 'quant':1, 'total':69.90, 'is_confirmed':true, 'creation_date':'23/03/2020','creation_time':'20:21:35', 'description':'Self service sem churrasco', 'have_promotion':false, 'show_options':false,'image':'/static/images/commands/refeicao.jpg'},
              ]},
              {'id':'3', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'4', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'5', 'group':'externo', 'status':'opened', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:5, 'products':[]},
              {'id':'6', 'group':'externo', 'status':'opened', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:30, 'products':[]},
              {'id':'7', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'8', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'9', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'10', 'group':'interno', 'status':'opened', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'11', 'group':'externo', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'12', 'group':'externo', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'13', 'group':'interno', 'status':'opened', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'14', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'15', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'16', 'group':'interno', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'17', 'group':'externo', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'18', 'group':'externo', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'19', 'group':'externo', 'status':'opened', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},
              {'id':'20', 'group':'externo', 'status':'closed', 'value':'', 'opening_time': null, 'closing_time': null, last_updated:null, 'products':[]},*/
            ],

            commands:{},

            complements:[
              {'id':'1', 'name':'Ovo', 'price':1.50, 'quant':0},
              {'id':'1', 'name':'Queijo', 'price':2.00, 'quant':0},
              {'id':'1', 'name':'Presunto', 'price':2.00, 'quant':0},
              {'id':'1', 'name':'Hamburguer', 'price':3.50, 'quant':0},
            ],

            groups: [
              /*{'id':'1', 'code':'1', 'name':'Refeição', 'description':'', 'image':'/static/images/commands/refeicao.jpg',
                'products':[
                  {'id':'1', 'code':'10', 'name':'Rodizio', 'price':69.90, 'description':'Rodízio de carnes convencionais e exóticas', 'have_promotion':true, 'image':'/static/images/commands/entradas.jpg'},
                  {'id':'2', 'code':'11', 'name':'Buffet sem churrasco', 'price':35.00, 'description':'Self service sem churrasco', 'have_promotion':false, 'image':'/static/images/commands/refeicao.jpg'},
                  {'id':'3', 'code':'12', 'name':'Buffet com churrasco', 'price':42.00, 'description':'Self service com churrasco', 'have_promotion':false},
                  {'id':'4', 'code':'13', 'name':'Buffet especial', 'price':69.90, 'description':'Comidas japonesas e arabes, moquecas e tortas especiais', 'have_promotion':true},
                  {'id':'4', 'code':'13', 'name':'Marmitex', 'price':14.00, 'description':'Arroz, feijão, macarrão, duas carnes, farofa, batata frita e salada.', 'have_promotion':true},
                ]
              },


              {'id':'1', 'code':'1', 'name':'Entradas', 'description':'', 'image':'/static/images/commands/entradas.jpg',
                'products':[
                  {'id':'1', 'code':'10', 'name':'Torradas', 'price':8.90, 'description':'250g de torradas amanteigadas com orégano', 'have_promotion':false},
                  {'id':'2', 'code':'11', 'name':'Torresmo', 'price':13.50, 'description':'150g de torresmo', 'have_promotion':false},
                  {'id':'3', 'code':'12', 'name':'Porção de frios', 'price':18.50, 'description':'Salame, ovos de codorna, palmito e queijo em cubinhos', 'have_promotion':false},
                  {'id':'4', 'code':'13', 'name':'Pasteis sortidos', 'price':21.50, 'description':'6 unidades sortidas', 'have_promotion':true},
                ]
              },


              {'id':'2', 'code':'2', 'name':'Porções', 'description':'', 'image':'/static/images/commands/porcoes.jpg',
                'products':[
                  {'id':'5', 'code':'20', 'name':'Pasteis sortidos', 'price':27.50, 'description':'', 'have_promotion':true},
                  {'id':'6', 'code':'21', 'name':'Bolinhas de queijo', 'price':32.80, 'description':'', 'have_promotion':false},
                  {'id':'7', 'code':'22', 'name':'Filé com fritas', 'price':39.90, 'description':'', 'have_promotion':true},
                  {'id':'8', 'code':'23', 'name':'Filé de tilapia', 'price':45.50, 'description':'', 'have_promotion':false},
                ]
              },

              {'id':'3', 'code':'3', 'name':'Pizzas', 'description':'', 'image':'/static/images/commands/pizza.jfif',
                'products':[
                  {'id':'9', 'code':'30', 'name':'Portuguesa', 'price':27.50, 'description':'', 'have_promotion':true},
                  {'id':'10', 'code':'31', 'name':'Calabresa', 'price':33.80, 'description':'', 'have_promotion':false},
                  {'id':'11', 'code':'32', 'name':'Marguerita', 'price':39.90, 'description':'', 'have_promotion':true},
                  {'id':'12', 'code':'33', 'name':'Americana', 'price':45.50, 'description':'', 'have_promotion':false},
                ]
              },

              {'id':'4', 'code':'4', 'name':'Drinks', 'description':'', 'image':'/static/images/commands/drinks.jpg',
                'products':[
                  {'id':'5', 'code':'21', 'name':'Caipivodka', 'price':10.00, 'description':'Vodka batida com limão, açucar e gelo', 'have_promotion':true},
                  {'id':'6', 'code':'22', 'name':'Mad Max', 'price':8.00, 'description':'Vodka com energético', 'have_promotion':true},
                  {'id':'7', 'code':'23', 'name':'Canelinha', 'price':5.00, 'description':'Dose de canelinha', 'have_promotion':false},
                  {'id':'8', 'code':'24', 'name':'Pina colada', 'price':14.50, 'description':'Vodka batida com abacaxi, coco e leite condensado', 'have_promotion':false},
                ]
              },*/
            ],
          }
        },

        filters: {
          round: function(value){
            return value.toFixed(2);
            //alert("OI");
          }
        },

        methods: {
          filter_tables: function(option){
            this.selected.table_group = option;
            alert("troquei "+option);
          },

          print_command: function(command){
            window.open("/api/sales/command/"+command.code+"/", "_blank");
          },

          print_order: function(order){
            window.open("/api/sales/commands/order/"+order.id+"/", "_blank");
          },

          confirm_item: function(item){
            alert("confirmei");
          },

          confirm_new_itens: function(){
            let scope = this;
            for (index in this.selected.new_products) {
              var value = this.selected.new_products[index];
              value.is_confirmed = true;
              this.selected.table.products.unshift(value);
            }
            this.selected.new_products = [];
          },

          show_options: function(item){
            if(item.show_options == true){
              item.show_options = false;
            }
            else{
              item.show_options = true;
            }
          },

          save_order: function(){
            let scope = this;
            let data_paramters = {};
            data_paramters['command_id'] = this.selected.command.id;
            data_paramters['product_id'] = this.selected.product.id;
            data_paramters['product_name'] = this.selected.product.name;
            data_paramters['product_image'] = this.selected.product.image;
            data_paramters['product_price'] = this.selected.product.price;
            data_paramters['quantity'] = this.forms.order.object.quantity;
            data_paramters['total'] = this.selected.product.price*this.forms.order.object.quantity;

            data_paramters['checkin_time'] = null;
            data_paramters['checkout_time'] = null;
            data_paramters['waiting_time'] = null;
            data_paramters['implement_time'] = null;
            data_paramters['duration_time'] = null;
            data_paramters['status'] = null;
            data_paramters['observations'] = this.forms.order.object.observations;

            let success_function = function(response) {
              scope.selected.command.orders.unshift(response.object);
              scope.selected.command.total = parseFloat(scope.selected.command.total) + parseFloat(response.object.total);
              scope.selected.new_product = null;
              $('#exampleModal').modal('hide');
            };

            let failure_function = function(response) {
              return false;
            };

            this.request('/api/sales/commands/order/save/', "post", data_paramters, null, success_function, failure_function);
          },

          select_item: function(command, item){
            this.selected.command = command;
            this.selected.product = {'id':parseInt(item.product), 'code':'0', 'name':item.product_name, 'image':item.product_image, 'price':item.product_price, 'quantity':1, 'description':'', 'have_promotion':true, 'is_confirmed':false, 'show_options':false};;

            /*this.forms.order.object = {
              command: command.id,
              product: item.id,
              product_name: item.product_name,
              product_price: item.price,
              quantity: 1,
              total: item.price,

              checkin_time: null,
              checkout_time: null,
              waiting_time: null,
              implement_time: null,
              duration_time: null,
              is_confirmed: false,
              show_options: false,
              status: "WAITING",
              observations:"",
            }*/
            //alert('cade?')

            //$("#exampleModal").modal();
            //$('#exampleModal').modal('show');

            /*if(item.is_confirmed){
              let new_item = JSON.parse(JSON.stringify(item));
              new_item.quant = 1;
              new_item.is_confirmed = false;
              new_item.show_options = false;
              this.selected.new_products.push(new_item);
            }*/
          },

          unselect_item: function(item){
            this.selected.item = null;
          },

          increase_item: function(index){
            this.selected.table.products[index].quant = this.selected.table.products[index].quant + 1
            //item.quant = item.quant + 1;
            //this.selected.item.quant = this.selected.item.quant + 1;
          },

          decrease_item: function(index){
            if(this.selected.table.products[index].quant >1){
              this.selected.table.products[index].quant = this.selected.table.products[index].quant - 1
            }
            else{
              this.selected.table.products[index].quant = 0
              //this.selected.table.products.shift()
              this.selected.table.products.splice(index,1);
            }
          },

          increase_new_item: function(index){
            this.selected.new_products[index].quant = this.selected.new_products[index].quant + 1
          },

          decrease_new_item: function(index){
            if(this.selected.new_products[index].quant >1){
              this.selected.new_products[index].quant = this.selected.new_products[index].quant - 1
            }
            else{
              this.selected.new_products[index].quant = 0
              //this.selected.table.products.shift()
              this.selected.new_products.splice(index,1);
            }
          },



          verify_screen: function () {
            this.controls.screen.width = window.innerWidth;
            this.controls.screen.height = window.innerHeight;
          },

          init_complements: function(){

          },

          open_menu: function(command, index){
            this.selected.command = command;
            this.selected.command_index = index;
            this.selected.new_product = true;
          },

          load_tables: function () {
            let scope = this;
            let success_function = function(response) {
              scope.tables = response.object;
            };

            let failure_function = function(response) {
              return false;
            };

            this.request('/api/sales/commands/tables/load/', "get", null, null, success_function, failure_function);
          },

          select_table: function(table, index){
            let scope = this;
            if(table.status=='CLOSED'){
              if (confirm("Abrir nova comanda na mesa "+table.code)) {
                scope.open_table(table, index);
                this.open_command(table, index);
              }
            }

            else{
              this.selected.table = table;
              this.selected.table_index = index;
            }
          },

          unselect_table: function(table){
            this.selected.table = null;
          },


          open_command: function(table, index){
            let scope = this;
            let data_paramters = {'table_id':table.id}

            let success_function = function(response) {
              scope.tables[index].commands.push(response.object);
              scope.selected.table = table;
              scope.selected.table_index = index;
            };

            let failure_function = function(response) {

            };

            this.request('/api/sales/commands/open/', "post", data_paramters, null, success_function, failure_function);
          },

          close_command: function(command, index){
            let scope = this;
            let data_paramters = {'command_id':command.id}

            if(table.status=='CLOSED'){
              if (confirm("Deseja mesmo Encerrar a command "+command.code)) {
                //scope.open_table(table, index);
                //this.open_command(table, index);
                alert("ihh cara.. vc quer encerrar mesmo");

                let success_function = function(response) {
                  scope.tables[index].commands.push(response.object);
                  scope.selected.table = table;
                  scope.selected.table_index = index;
                };

                let failure_function = function(response) {

                };

                //this.request('/api/sales/commands/close/', "post", data_paramters, null, success_function, failure_function);
              }
            }



          },

          open_table: function (table, index) {
            let scope = this;
            let data_paramters = {'table_id':table.id}

            let success_function = function(response) {
              scope.tables[index] = response.object;
            };

            let failure_function = function(response) {};

            this.request('/api/sales/commands/tables/open/', "post", data_paramters, null, success_function, failure_function);
          },

          close_table: function (table, index) {
            let scope = this;
            let data_paramters = {'table_id':table.id}

            let success_function = function(response) {
              scope.tables[index] = response.object;
            };

            let failure_function = function(response) {

            };

            this.request('/api/sales/commands/table/close/', "post", data_paramters, null, success_function, failure_function);
          },


          load_groups: function () {
            let scope = this;
            let success_function = function(response) {
              scope.groups = response.object;
            };

            let failure_function = function(response) {
              return false;
            };

            this.request('/api/sales/commands/groups/load/', "get", null, null, success_function, failure_function);
          },

          update_clock: function(){
            this.controls.clock = moment().utc().format();
            //this.controls.clock = new Date().utc().format();
          }
        },

        computed: {
          current_time: function(){
            if(this.controls.clock){
              return moment(String(this.controls.clock)).format('HH:mm:ss');
              //return this.controls.clock.format("hh:mm:ss");
            }
          },

          product_in_command: function(){
            let new_array = [];
            this.selected.table.commands.products.forEach(function(item, chave){
              if(item.quant > 0){
                new_array.push(item);
              }
              else{
                alert(item.name+":"+item.quant+"TIRAR");
              }
            });

            console.log("VEJA COMO FICOU ENTAO:"+JSON.stringify(new_array));
            this.selected.table.products = new_array;
            return this.selected.table.products;
          },
        },

        created: function () {
          //this.load_tables();
          //this.init_product_complements();
        },

        mounted: function () {

        }
      });

      window.addEventListener('resize', function(e) {
        app.verify_screen();
      });
    </script>

    <script>
      function success_notify(){
      }

      window.addEventListener('load', function () {
        app.load_tables();
        app.load_groups();
        register_action();
      }, false);

      window.addEventListener('resize', function(e) {
        app.verify_screen();
      });

      var clock = setInterval(function(){app.update_clock()},1000);
    </script>
  </body>
</html>