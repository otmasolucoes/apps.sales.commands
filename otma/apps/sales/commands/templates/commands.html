<!DOCTYPE html>
<html lang="pt-br" xmlns:script="http://www.w3.org/1999/html">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Melinux - Controle de comandas</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'bower_components/bootstrap/dist/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'bower_components/font-awesome/css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/float_notification.css' %}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="{% static 'bower_components/vue/dist/vue.js' %}"></script>
    <script src="{% static 'base_controller.js' %}"></script>
    <script src="{% static 'commands_controller.js' %}"></script>

    <style>
      /*
        AUTO GRID
        Set the minimum item size with `--auto-grid-min-size` and you'll
        get a fully responsive grid with no media queries.
      */

      .auto-grid-large {
        --auto-grid-min-size: 14rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
        grid-gap: 1rem;
      }

      .auto-grid-small {
        --auto-grid-min-size: 6rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
        grid-gap: 1rem;
      }

      #table-panel .auto-grid-large {
        --auto-grid-min-size: 8rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
        grid-gap: 1rem;
      }

      #table-panel .auto-grid-small {
        --auto-grid-min-size: 5rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(var(--auto-grid-min-size), 1fr));
        grid-gap: 1rem;
      }

      ::-webkit-scrollbar {
          display: none;
      }

      /* Presentational styles */
      html, body {
        background-image: url("/static/apps/sales/commands/images/background-sm.png");
        /*line-height: 1.4;*/
        font-family: Tahoma, Geneva, sans-serif;
        margin: 0;
        padding: 0;
        height: 100%;
        overflow-x: hidden;
        /*overflow-y: hidden;*/
      }

      #table-panel li {
        text-align: left;
        background: #ccc;
        color: #ffffff;
      }

      #table-panel li.opened {
        background: #6d996d;
      }

      #table-panel li.waiting {
        background: #a44a4a;
      }

      #consumed_products td {
        padding:0px;
      }


      ul #product-menu{
        list-style-type: none;
      }

      ul#product-menu li {
        text-align: left;
        /*background: rgb(178,34,34,0.85);*/
        /*background: linear-gradient(0deg, rgba(178,34,34,1) 0%, rgba(178,34,34,1) 92%, rgba(134,28,28,1) 100%);*/
        color: #ffffff;
      }

      ul#product-menu li span {
        position: relative;
        left:4px;
        top: 4px;
      }

      ul#product-menu li:hover {
        /*background: #8e1b1b;*/
        /*filter: grayscale(20%);*/
        /*background: hsla(180,0%,50%,0.5);*/
        /*background-color: rgba(var(--rgb), 0.8);*/

        /*background-image:linear-gradient(hsla(255,100%,100%,.8) 100%,transparent 100%)*/
        background: rgb(178,34,34,1.0);
      }

      ul#product-menu li:hover {
        filter:brightness(120%);
      }

      .auto-grid-small {

      }

      .auto-grid-large {
        font-size: 1.0rem;
      }

      .menu-item-image{
        object-fit:cover;
        width:100%;
        height:155px;
      }

      .auto-grid-small .menu-item-image{
        height:70px;
      }

      .menu-item-price{
        border-bottom-left-radius: 5px;
        text-align: right;
        color: #b22222;
        height: 20px;
        float: right;
      }

      .auto-grid-large .menu-item-price{
        padding-left:20px;
        padding-top: 0px;
        margin-top:-155px;
        font-size:14px;
      }

      .auto-grid-small .menu-item-price{
        padding-left:15px;
        margin-top:-73px;
        padding-top:3px;
        font-size:11px;
      }

      #product_complements, #product_description {
        font-size:12px;
      }

      #product_complements thead tr td{
        font-size:10px;
        border-top: none;
      }

      #product_complements td, #product_description td{
        vertical-align:middle;
      }

      .selected {
        /*background:#237dd7;*/
        background: #bababa;
        color: white !important;
      }

      #footer-menu{
        color: #ccc;
      }

      #footer {
        padding:6px;
        background:#202020;
        color:#ffffff;
        width: 100%;
        position: fixed;
        bottom: 0;
        left: 0;
        border-top: 2px solid #646464;
      }

      .menu-active{
        color: #fff;
        /*background-color: rgba(60, 60, 60, 0.90);*/
      }

      .order_decoration {
        font-family:arial;
        padding:10px;
        margin-top:-65px;
        height:65px;
        /*background-color: rgba(28, 28, 28, 0.90);*/
        color:white;
      }

      .no-border-first:first-child {
        border-top: 2px solid #fff;
      }

      /*html { scroll-behavior: smooth; }*/

      .fa.pisca {
          font-size: 30px;
          color: red;
          opacity: 0;
          animation: anima 1s ease infinite;
      }

      @keyframes anima {
          to {
              opacity: 1;
          }
      }

      .icon-badge-group .icon-badge-container {
        display: inline-block;
        margin-left: 12px;
      }

      .icon-badge-group .icon-badge-container:first-child {
        margin-left: 0
      }

      .icon-badge-container {
        margin-top: 20px;
        position: relative;
      }

      .icon-badge-icon {
        font-size: 17px;
        position: relative;
      }

      .icon-badge {
        background-color: red;
        font-size: 12px;
        color: white;
        text-align: center;
        width: 16px;
        height: 18px;
        border-radius: 35%;
        position: relative;
        top: -35px;
        left: 12px;
      }
    </style>

  </head>

  <body>
    <div style='padding:0px;'>
      <div id="app" @mousemove="" @keyup="">
        <template v-if='controls.screen.width<=1024 && list_orders_ready.length > 0'>
          <div class="floating-container">
            <div class="floating-button" @click="view_orders_ready()">
              <i class="material-icons">notifications_on</i>
            </div>
            <!--<div class="element-container">

              <a href="google.com">
                <span class="float-element tooltip-left">
                  <i class="material-icons">phone</i>
                </span>
              </a>
                <span class="float-element">
                  <i class="material-icons">email</i>
                </span>
                <span class="float-element">
                  <i class="material-icons">chat</i>
                </span>
            </div>-->
          </div>
        </template>
        <div v-if='controls.screen.width>=1024' :style='controls.styles.themes.active.header'>

          <div :style='controls.styles.themes.active.header_division'>
            <table border='0' style="width:100%;">
              <tr>
                <td style="padding-left:10px;text-align:left;font-family:Brush Script MT, Brush Script Std, cursive;font-size:30px;">{{ company_name }}</td>

                <td v-if="selected.table" style="width:25px;" title="Retornar a pagina anterior"><!-- v-if='controls.screen.fullscreen_mode'-->
                  <span @click="back_menu()" style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;"><!--@click="selected.table=null" v-if="selected.table!=null"  -->
                    <i class="fas fa-arrow-left"></i>
                  </span>
                </td>

                <td style="width:25px;" title="Minhas Notificações">
                  <div class="icon-badge-container">
                    <i class="fas fa-bell icon-badge-icon"></i>
                    <div class="icon-badge">6</div>
                  </div>
                  <!--<span style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;">
                    <i class="fas fa-bell"></i>
                  </span>-->
                </td>

                <!-- OPÇÃO PARA PODER FILTRAR MESAS PELO STATUS OU AREA
                <td v-if="selected.table==null" style="width:40px;">
                  <div class="dropdown">
                    <span class="" id="dropdownMenuButton" title="Filtrar mesas" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;">
                      <i class="fas fa-filter"></i>
                    </span>

                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="font-size:12px;">
                      <a class="dropdown-item" href="#" @click="selected.table_group='INTERNA'" style="padding-right:10px;">
                        Mesas internas <i v-if="selected.table_group=='INTERNA'" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                      </a>

                      <a class="dropdown-item" href="#" @click="selected.table_group='EXTERNA'" style="padding-right:10px;">
                        Mesas externas <i v-if="selected.table_group=='EXTERNA'" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                      </a>
                      <a class="dropdown-item" href="#" @click="selected.table_group='WAITING'" style="padding-right:10px;">
                        Mesas aguardando <i v-if="selected.table_group=='WAITING'" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                      </a>

                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" href="#" @click="selected.table_group='GERAL'" style="padding-right:10px;">
                        Todas as mesas <i v-if="selected.table_group=='GERAL'" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                      </a>
                    </div>
                  </div>
                </td>-->

                <!-- POSSIVEL MENU PRA ESCOLHER TEMAS.. ISSO PODE APARECER DEPOIS EM UMA JANELA DE CONFIGURAÇÕES

                <td style="width:40px;">
                  <div class="dropdown">
                    <span class="" id="dropdownMenuButton" title="Preferências" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;">
                      <i class="fas fa-tools"></i>
                    </span>

                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="font-size:12px;">
                      {% verbatim %}
                      <template v-for="theme in controls.styles.themes.options">
                        <a class="dropdown-item" href="#" @click="controls.styles.themes.active=theme" style="padding-right:10px;">
                          {{ theme.name }} <i v-if="controls.styles.themes.active.name==theme.name" class="float-right fas fa-check" style="position:relative;top:3px"></i>
                        </a>
                      </template>
                      {% endverbatim %}
                    </div>
                  </div>
                </td>-->

                <td style="width:25px;">
                  <div class="dropdown">
                    <span class="" style="cursor:pointer;fonts-size:14px;width:80px;text-align:center;padding:11px;" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fas fa-user"></i>
                    </span>

                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <!--<a class="dropdown-item" href="#">Nada ainda</a>-->
                      <span style="text-align: center;padding-left: 10px;">Opções</span>
                      <div class="dropdown-divider"></div>
                      <a class="dropdown-item" @click="back_menu()">Atualizar</a>
                      <a class="dropdown-item" href="/sales/commands/logout/">Sair</a>
                    </div>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>

        {% verbatim %}
        <div style="padding:15px;">
          <template v-if="selected.new_product">
            <app_commands :controls="controls" :forms="forms" :selected="selected" :groups="groups" :complements="complements" :init_complements="init_complements" :new_products="selected.new_products"></app_commands>
          </template>

          <div v-else-if='selected.table==null' id="table-panel">
            <ul id='tables-list' :class="{'auto-grid-small':controls.screen.width<1024, 'auto-grid-large':controls.screen.width>=1024}" style='margin-left:-40px;'>
              <template v-for='(table, table_index) in tables'>
                <li v-if="table.area==selected.table_group || table.status==selected.table_group || selected.table_group=='GERAL'" @click="select_table(table, table_index)" :class="{'opened':table.status=='ACTIVE', 'waiting':table.status=='WAITING'}" style='vertical-align:middle;padding:15px;cursor:pointer;padding-bottom:15px;padding-top:15px;line-height:15px;'>
                  <div style="text-align:center;">
                    <i v-if="table.status=='WAITING'" class="fa fa-user-clock fa-2x" :id="'table-icon_' + table_index"></i>
                    <i v-else-if="table.status=='ACTIVE'" class="fa fa-users fa-2x" :id="'table-icon_' + table_index"></i>
                    <i v-else class="fa fa-users fa-2x" :id="'table-icon_' + table_index"></i>
                    <br>
                    <!--<span style="position:relative;top:4px;">Mesa {{ table.code }}</span><br>
                    <span style="font-size:10px;">{{ table.area }}</span>-->
                    <span style="position: relative;top: 6px;font-size: 18px;font-weight: bold;">{{ table.code }}</span><br>
                    <span v-if="table.status=='ACTIVE'" style="font-size: 13px;position: relative;top: 6px;">{{ user.username }}</span><br>
                    <span style="font-size: 10px;"> </span>
                  </div>
                </li>
              </template>
            </ul>
          </div>

          <div class="" v-else style="height: calc(100vh - 150px);">
            <div>
              <h6 style="background:white;padding-right:5px;">
                <div class="row">
                  <div class="col-4 col-md-4 float-left" style="position: relative;top: 0px;padding-top: 5px;">
                    <div class="dropdown">
                      <!--<button class="btn btn-sm btn-light" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="false" aria-expanded="false">-->

                      <button class="btn btn-sm btn-light" type="button" data-toggle="modal" data-target="#MenuModal">
                        <i class="fas fa-bars"></i>
                      </button>

                      <!--<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="#" style="font-size:12px;padding-left:15px;padding-right:5px;" @click="open_command(selected.table, selected.table_index)"><i class="fas fa-plus"></i> Adicionar comanda</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" @click="view_order()" style="cursor:pointer;font-size:12px;padding-left:15px;padding-right:5px;"><i class="fas fa-search"></i> Visualizar pedido</a>
                        <a class="dropdown-item" @click="print_order(selected.order)" style="cursor:pointer;font-size:12px;padding-left:15px;padding-right:5px;"><i class="fas fa-print"></i> Reimprimir pedido</a>
                        <a class="dropdown-item" href="#" style="cursor:pointer;font-size:12px;padding-left:15px;padding-right:5px;"><i class="fas fa-times"></i> Cancelar pedido</a>
                      </div>-->

                      <div class="modal fade" id="MenuModal" tabindex="-1" role="dialog">
                        <div class="modal-dialog modal-dialog-centered">
                          <div class="modal-content">
                            <div class="modal-header">
                              <!--<button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal"> X </button>-->
                              <h4>Menu</h4>
                            </div>
                            <div class="modal-body">

                              <!--<form role="form">
                                <div class="form-group">
                                  <label for="usrname">
                                    <span class="glyphicon glyphicon-user"></span>
                                    Usuário
                                  </label>
                                  <input type="text" class="form-control" id="usrname" placeholder="Informe o nome do usuário">
                                </div>
                                <div class="form-group">
                                  <label for="psw">
                                    <span class="glyphicon glyphicon-eye-open"></span>
                                    Senha
                                  </label>
                                  <input type="text" class="form-control" id="psw" placeholder="Informe a senha">
                                </div>
                                <div class="checkbox">
                                  <label>
                                    <input type="checkbox" value="" checked>
                                    Lembrar-me
                                  </label>
                                </div>
                                <button type="submit" class="btn btn-default btn-success btn-block">
                                  <span class="glyphicon glyphicon-off"></span>
                                  Login
                                </button>
                              </form>-->

                              <template>
                                <template class="dropdown-item" style="padding-top: 10px;height: 40px;cursor: pointer;">
                                  <a @click="open_command(selected.table, selected.table_index)" style="font-size:15px;padding-left:15px;padding-right:5px;">
                                    <i class="fas fa-plus"></i>
                                     Adicionar comanda
                                  </a>
                                </template>
                              </template>

                              <template v-if="(selected.order && selected.order.status!=='CLOSED')">

                                <!--<template v-if="selected.order.was_sent">
                                  <div class="dropdown-divider"></div>
                                  <template class="dropdown-item" style="padding-top: 10px;height: 40px;cursor: pointer;">
                                    <a @click="view_order()" style="font-size:15px;padding-left:15px;padding-right:5px;">
                                      <i class="fas fa-search"></i>
                                      Visualizar pedido
                                    </a>
                                  </template>
                                </template>-->

                                <template v-if="selected.order.was_sent">
                                  <div class="dropdown-divider"></div>
                                  <template class="dropdown-item" style="padding-top: 10px;height: 40px;cursor: pointer;">
                                    <a class="dropdown-item" @click="print_order(selected.order)" style="font-size:15px;padding-left:15px;padding-right:5px;">
                                      <i class="fas fa-print"></i>
                                      Reimprimir item
                                    </a>
                                  </template>
                                </template>

                                <template v-if="!(selected.order.was_sent)">
                                  <div class="dropdown-divider"></div>
                                  <template class="dropdown-item" style="padding-top: 10px;height: 40px;cursor: pointer;">
                                    <a class="dropdown-item" @click="cancel_item(selected.order_index, selected.order)" style="font-size:15px;padding-left:15px;padding-right:5px;">
                                      <i class="fas fa-times"></i>
                                      Cancelar item
                                    </a>
                                  </template>
                                </template>

                                <template v-if="selected.order.was_sent">
                                  <div class="dropdown-divider"></div>
                                  <template class="dropdown-item" style="padding-top: 10px;height: 40px;cursor: pointer;">
                                    <a class="dropdown-item" @click="delivered_item(selected.order_index, selected.order, 'CLOSED')" style="font-size:15px;padding-left:15px;padding-right:5px;">
                                      <i class="fas fa-thumbs-up"></i>
                                      Entregue
                                    </a>
                                  </template>
                                </template>

                              </template>

                            </div>
                            <div class="modal-footer">

                              <!--<button type="submit" class="btn btn-default btn-default pull-left" data-dismiss="modal">
                                <span class="glyphicon glyphicon-remove"></span>
                                Cancelar
                              </button>-->

                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-4 col-md-4" style="padding-top: 5px;text-align: center;">
                    <span style="position:relative;top:2px;font-size: 20px">Mesa {{ selected.table.code }}</span>
                  </div>

                  <div class="col-4 col-md-4" style="text-align: right">
                    <span style="position:relative;top:7px;color:#777;font-family:Arial;font-size: 20px">R$ {{ selected.table.total | format_money }}</span>
                  </div>
                </div>
              </h6>
            </div>

            <template v-if="selected.table.commands.length==0">
              <div style="text-align: center; padding-top: 200px">
                <span style="font-size: 38px;">Nenhuma comanda aberta nessa mesa</span>
              </div>
            </template>

            <template v-else v-for="(command, command_index) in selected.table.commands">
              <div style="padding-top: 10px;"></div>

              <div id="consumed_products_panel" style="background:white;padding:5px;border:1px solid #ddd;padding-bottom: 100px;">
                <div style="height:50px;padding-bottom:50px;border-bottom:1px solid #ddd;">

                  <!--<div class="top: 15px; width: 10%;">
                    Comanda {{ command.code }}<br>
                    <!-<span style="font-size:12px;color:#666;">
                      Cliente não identificado
                      <template v-if="command.client">{{ command.client }}</template>
                      <template v-else>
                        <input v-if="forms.command.change_client_name" class="form-control" v-model="command.client" style="border-top:0px;border-left:0px;border-right:0px;"/><!- @submit="confirm_client_name_field()"  ->
                        <a v-else style="cursor:pointer;">Identificar cliente</a><-- data-toggle="modal" href="#update_command_client_modal" >
                      </template>
                      <template v-if="controls.screen.width>600">Entrada:</template>{{ command.checkin_time | format_datetime }}
                    </span>->
                  </div>-->

                  <div class="float-right" style="text-align: right;position: relative;top: 0px;padding-right: 0px;">
                    <button :disabled="!(selected.order && selected.order.was_sent && selected.command_index==command_index)" class="btn btn-sm btn-light" type="button" style="line-height: 1;height: 38px;"  data-toggle="modal" data-target="#StatusModal" aria-haspopup="true" aria-expanded="false">
                      <i class="fas fa-info-circle"></i><br><span style="font-size: 9px;">Status</span>
                    </button>

                    <button :disabled="!(selected.order && selected.order.was_sent && selected.command_index==command_index)" class="btn btn-sm btn-light" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="line-height: 1;height: 38px;">
                      <i class="fas fa-print"></i><br><span style="font-size: 9px;">Reimprimir</span>
                    </button>

                    <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                      <button v-for="(order_id, order_index) in list_orders_id" class="dropdown-item" type="button" @click="reprint_order(order_id)">Pedido nº {{ order_id }}</button>
                    </div>

                    <button type="button" class="btn btn-sm btn-light" @click="open_menu(command, command_index)" style="line-height: 1;height: 38px;">
                      <i class="fas fa-plus"></i><br><span style="font-size: 9px;">Adicionar</span>
                    </button>

                    <button @click="prepare_order()" type="button" class="btn btn-sm btn-light" style="line-height:1;height:38px;">
                      <i class="fas fa-paper-plane"></i><br><span style="font-size: 9px;">Enviar</span>
                    </button>

                    <button :disabled="!(selected.order && !selected.order.was_sent && selected.command_index==command_index)" type="button" class="btn btn-sm btn-light" @click="change_order(command, command_index, selected.order)" data-toggle="modal" data-target="#OrderModal" style="line-height:1;height:38px;">
                      <i class="fas fa-pencil-alt"></i><br><span style="font-size:9px;">Alterar</span>
                    </button>

                    <!--<button :disabled="!(selected.order && selected.command_index==command_index)" type="button" class="btn btn-sm btn-light" @click="open_menu(command, command_index)" style="line-height:1;height:38px;">
                      <i class="fas fa-print"></i><br><span style="font-size:10px;">Imprimir</span>
                    </button>

                    <button :disabled="!(selected.order && selected.command_index==command_index)" type="button" class="btn btn-sm btn-light" @click="open_menu(command, command_index)" style="line-height:1;height:38px;">
                      <i class="fas fa-times"></i><br><span style="font-size:10px;">Cancelar</span>
                    </button>-->

                    <!--<button type="button" class="btn btn-sm btn-light" @click="close_command(command, command_index)" style="line-height:1;height:38px;">
                      <i class="fas fa-sign-out-alt"></i><br><span style="font-size:9px;">Finalizar</span>
                    </button>-->

                    <!--<button type="button" class="btn btn-sm btn-secondary" style="line-height:1;width:110px;height:38px;"><span style="font-size:13px;font-weight:bold;">R$ {{ command.total }}</span><br><span style="font-size:10px;"><i class="fas fa-sign-out-alt"></i> Encerrar</span></button>-->

                    <!--<div class="btn-group">
                      <button type="button" class="btn btn-sm btn-secondary" style="line-height:1;width:115px;height:38px;" @click="close_command(command)">
                        <span style="font-weight:bold;font-size:15px;">R$ {{ command.total }}</span><br>
                        <span style="font-size:10px;"><i class="fas fa-sign-out-alt"></i> Encerrar</span>
                      </button>

                      <template v-if="command.total>0">
                      <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="sr-only">Toggle Dropdown</span>
                      </button>
                      <div class="dropdown-menu" style="font-size:11px;">
                        <a class="dropdown-item" href="#">R$ {{ command.total/2 | round }} para 2 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/3 | round }} para 3 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/4 | round }} para 4 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/5 | round }} para 5 pessoas</a>

                        <template v-if="command.total >= 300">
                        <a class="dropdown-item" href="#">R$ {{ command.total/6 | round }} para 6 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/7 | round }} para 7 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/8 | round }} para 8 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/9 | round }} para 9 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/10 | round }} para 10 pessoas</a>
                        </template>

                        <template v-if="command.total >= 500">
                        <a class="dropdown-item" href="#">R$ {{ command.total/11 | round }} para 11 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/12 | round }} para 12 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/13 | round }} para 13 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/14 | round }} para 14 pessoas</a>
                        <a class="dropdown-item" href="#">R$ {{ command.total/15 | round }} para 15 pessoas</a>
                        </template>
                      </div>
                      </template>
                    </div>-->
                  </div>
                </div>

                <br>

                <template v-if="command.orders && command.orders.length > 0">
                  <table border="0" id='consumed_products' class='table table-sm table-stripped' style='font-family:arial;margin-bottom:0px;'>
                    <template v-if='controls.screen.width>=1024'>
                      <thead>
                        <tr style="font-size:10px;font-weight:bold;font-weight:bold;">
                          <td colspan="2" style="text-align:left;border-top:none;">Produtos</td>
                          <td colspan="2" style="text-align:left;border-top:none;">Descrição</td>
                          <td colspan="2" style="text-align:center;border-top:none;">Confirmado</td>
                          <td colspan="2" style="text-align:center;border-top:none;">Status</td>
                          <td colspan="2" style="text-align:center;border-top:none;">Quantidade</td>
                          <td colspan="2" style="text-align:center;border-top:none;">Preço</td>
                          <td colspan="2" style="text-align:right;border-top:none;">Total</td>
                        </tr>
                      </thead>

                      <tbody>
                        <template v-for='(order, order_index) in command.orders'>
                          <tr :class="{'selected':order.show_options}" style="cursor:pointer;" @click="show_options(command_index, order, order_index)"><!-- data-toggle="modal" data-target="#command_item_options" -->
                            <td colspan="2" style="width:100px;">
                              <img :src="order.image" style='width:90px;height:60px;object-fit:cover;' />
                            </td>

                            <td colspan="2" style="padding-top: 5px;line-height:1.1;">
                              <span style='font-size:18px;'>{{ order.name }}</span><br>
                              <span style='font-size:12px;color:#888;'>Entrada: {{ order.checkin_time | format_time_short }} -
                              <template v-if="order.checkout_time==null">Previsão: {{ order.expected_time | format_time_short }}</template>
                              <template v-else>Entrega: {{ order.checkout_time | format_time_short }}</template></span>
                              <br>
                              <span style='font-size:12px;color:#888;'>Observações: {{ order.observations }}</span>
                            </td>

                            <td colspan="2" style="line-height: 1.1; text-align: center; vertical-align: middle;">
                              <template v-if="order.was_sent">
                                <i class="fas fa-check" style="color: green;"></i>
                              </template>
                              <template v-else-if="!order.was_sent">
                                <i class="fas fa-exclamation" style="color: orange;"></i>
                              </template>
                            </td>

                            <td colspan="2" style='width:40px;vertical-align:middle;text-align:center;'>

                              <template v-if="order.status=='WAITING'">
                                AGUARDANDO
                              </template>

                              <template v-else-if="order.status=='IN_PROGRESS'">
                                ANDAMENTO
                              </template>

                              <template v-else-if="order.status=='READY'">
                                PRONTO
                              </template>

                              <template v-else-if="order.status=='CANCELED'">
                                CANCELADO
                              </template>

                              <template v-else-if="order.status=='CLOSED'">
                                ENTREGUE
                              </template>

                              <template v-else-if="(controls.clock > order.expected_time && order.status=='WAITING' || order.status!='IN_PROGRESS' || order.status!='READY')">
                                <span style="color:red;font-size:12px;"><b>ATRASADO</b></span>
                              </template>
                            </td>

                            <td colspan="2" style='width:110px;text-align:center;vertical-align:middle;'>
                              <span style='font-size:18px;'>{{ order.quantity | format_money }}</span>
                            </td>

                            <td colspan="2" style="vertical-align:middle;text-align:center;width:110px;">
                              <span style='font-size:18px;'>R$ {{ order.price | format_money }}</span>
                            </td>

                            <td colspan="2" style='width:110px;text-align:right;vertical-align:middle;'>
                              <span style='font-size:18px;'>R$ {{ order.price * order.quantity | format_money }}</span>
                            </td>
                          </tr>

                        <!--<tr>
                          <td colspan="4">
                            <div class="btn-group">
                              <button type="button" class="btn btn-sm btn-secondary" style="line-height:1;height:38px;">
                                <span style="font-weight:bold;font-size:15px;">Não identificado</span><br>
                                <span style="font-size:10px;"><i class="fa fa-user"></i> Cliente</span>
                              </button>
                            </div>

                            <div class="dropdown">
                              <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span style="font-weight:bold;font-size:15px;">R$ {{ command.total }}</span><br>
                                <span style="font-size:10px;"><i class="fas fa-hand-holding-usd"></i> Por pessoa</span>
                              </button>

                              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                <a class="dropdown-item" href="#">Action</a>
                                <a class="dropdown-item" href="#">Another action</a>
                                <a class="dropdown-item" href="#">Something else here</a>
                              </div>
                            </div>

                            <div class="btn-group">
                              <template v-if="command.total>0">
                              <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width:100px;">
                                <span style="font-weight:bold;font-size:15px;">R$ {{ command.total }}</span><br>
                                <span style="font-size:10px;"><i class="fas fa-hand-holding-usd"></i> Por pessoa</span>
                              </button>
                              <div class="dropdown-menu" style="font-size:11px;">
                                <a class="dropdown-item" href="#">R$ {{ command.total/2 | round }} para 2 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/3 | round }} para 3 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/4 | round }} para 4 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/5 | round }} para 5 pessoas</a>

                                <template v-if="command.total >= 300">
                                <a class="dropdown-item" href="#">R$ {{ command.total/6 | round }} para 6 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/7 | round }} para 7 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/8 | round }} para 8 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/9 | round }} para 9 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/10 | round }} para 10 pessoas</a>
                                </template>

                                <template v-if="command.total >= 500">
                                <a class="dropdown-item" href="#">R$ {{ command.total/11 | round }} para 11 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/12 | round }} para 12 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/13 | round }} para 13 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/14 | round }} para 14 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/15 | round }} para 15 pessoas</a>
                                </template>
                              </div>
                              </template>
                            </div>
                          </td>


                          <td colspan="2">
                            <div class="btn-group">
                              <button type="button" class="btn btn-sm btn-secondary" style="line-height:1;width:115px;height:38px;" @click="close_command(command)">
                                <span style="font-weight:bold;font-size:15px;">R$ {{ command.total }}</span><br>
                                <span style="font-size:10px;"><i class="fas fa-sign-out-alt"></i> Encerrar</span>
                              </button>

                              <template v-if="command.total>0">
                              <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="sr-only">Toggle Dropdown</span>
                              </button>
                              <div class="dropdown-menu" style="font-size:11px;">
                                <a class="dropdown-item" href="#">R$ {{ command.total/2 | round }} para 2 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/3 | round }} para 3 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/4 | round }} para 4 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/5 | round }} para 5 pessoas</a>

                                <template v-if="command.total >= 300">
                                <a class="dropdown-item" href="#">R$ {{ command.total/6 | round }} para 6 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/7 | round }} para 7 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/8 | round }} para 8 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/9 | round }} para 9 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/10 | round }} para 10 pessoas</a>
                                </template>

                                <template v-if="command.total >= 500">
                                <a class="dropdown-item" href="#">R$ {{ command.total/11 | round }} para 11 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/12 | round }} para 12 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/13 | round }} para 13 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/14 | round }} para 14 pessoas</a>
                                <a class="dropdown-item" href="#">R$ {{ command.total/15 | round }} para 15 pessoas</a>
                                </template>
                              </div>
                              </template>
                            </div>
                          </td>
                        </tr>-->

                        </template>
                      </tbody>
                    </template>

                    <template v-else>
                      <tbody>
                        <template v-for='(order, order_index) in command.orders'>
                          <tr class="no-border" :class="{'selected':order.show_options}" @click="show_options(command_index, order, order_index)" style="cursor:pointer; border-top: 2px solid #41464b;">
                            <td colspan="12" style="border-bottom-width: 0px;">
                              <template>
                                <span style="font-size:14px;font-weight: bold;">{{ order.name }}</span>
                              </template>
                            </td>

                            <!--<td colspan="4" style="padding-bottom:10px;">
                              <div>
                                <span style='font-size:12px;position:relative;top:2px;'>
                                  <span style="padding-right:8px;">
                                    <i class="fas fa-arrow-up" style=""></i>
                                    {{ order.checkin_time | format_time_short }}
                                  </span>

                                  <span style="padding-right:8px;">
                                    <template v-if="order.checkout==null">
                                      <i class="fas fa-clock"></i>
                                      {{ order.expected_time | format_time_short }}
                                    </template>

                                    <template v-else>
                                      <i class="fas fa-arrow-down" style="color:green;"></i>
                                      {{ order.checkout | format_time_short }}
                                    </template>
                                  </span>

                                  <span style="">
                                    <template v-if="(controls.clock < order.expected_time && order.status == 'WAITING')">
                                      <span style="font-size:12px;">AGUARDANDO</span>
                                    </template>

                                    <template v-else-if="(controls.clock > order.expected_time && order.status!='CLOSED')">
                                      <span style="color:#a60e0e;font-size:12px;">ATRASADO</span>
                                    </template>

                                    <template v-else-if="order.status == 'CLOSED'">
                                      <span style="font-size:12px;">ENTREGUE</span>
                                    </template>
                                    <template v-else>
                                      <span style="font-size:12px;">{{ order.status }}</span>
                                    </template>
                                  </span>
                                </span>
                              </div>
                            </td>-->

                          </tr>

                          <tr class="no-border-first" :class="{'selected':order.show_options}">
                            <td colspan="3" style="vertical-align: middle;">
                              <template v-if="order.was_sent">
                                  <span style="padding-right:8px;font-size:14px;">
                                    <!--<i class="fas fa-arrow-up" style=""></i>-->
                                    Ped: {{ order.checkin_time | format_time_short }}
                                  </span>
                              </template>
                              <template v-else-if="!order.was_sent">
                                <!-- NADA AQUI -->
                              </template>
                            </td>
                            <td colspan="3" style="vertical-align: middle;">
                              <!--<template v-if="order.was_sent">
                                    <template v-if="order.checkout==null">
                                      <!-<i class="fas fa-arrow-down"></i>->
                                      Entr: {{ order.expected_time | format_time_short }}
                                    </template>
                              </template>
                              <template v-else-if="!order.was_sent">
                                <!- NADA AQUI ->
                              </template>-->
                              <!--<template v-else-if="(controls.clock > order.expected_time && order.status!='CLOSED')">
                                <span style="color:#a60e0e;font-size:12px;">ATRASADO</span>
                              </template>-->
                              <template v-if="order.status == 'WAITING'">
                                <span style="font-size:14px;"></span>
                              </template>
                              <template v-else-if="order.status == 'IN_PROGRESS'">
                                <span style="font-size:14px;">PREPARANDO</span>
                              </template>
                              <template v-else-if="order.status == 'READY'">
                                <span style="font-size:14px;">PRONTO</span>
                              </template>
                              <template v-else-if="order.status == 'CLOSED'">
                                <span style="font-size:14px;">Entr: {{ order.expected_time | format_time_short }}</span>
                              </template>
                              <template v-else>
                                <span style="font-size:14px;">{{ order.status }}</span>
                              </template>
                            </td>
                            <td colspan="3" style="text-align:right;vertical-align: middle;">
                              <span style="font-size:14px;">{{ order.quantity }}</span>
                            </td>
                            <td colspan="3" style="text-align:right;vertical-align: middle;font-weight: bold;">
                              <div>{{ order.price | format_money}}</div>
                            </td>
                          </tr>

                          <tr v-for="complement in order.complements" class="no-border-first" :class="{'selected':order.show_options}">
                            <td colspan="4" style="vertical-align: middle;">
                              <template>
                                <span style="font-size:12px;">{{ complement.name }}</span>
                              </template>
                            </td>
                            <td colspan="4" style="text-align:right;vertical-align: middle;">
                              <template>
                                <span style="font-size:12px;">{{ complement.quantity }}</span>
                              </template>
                            </td>
                            <td colspan="4" style="text-align:right;vertical-align: middle;">
                              <template>
                                <span style="font-size:12px;">{{ complement.price | format_money }}</span>
                              </template>
                            </td>
                          </tr>

                          <!--<tr>
                            <td colspan="2">Total <span class="float-right">R$ {{ command.total }}</span></td>
                          </tr>-->

                        </template>
                      </tbody>
                    </template>

                    <tr>
                      <td colspan="6">Total</td>
                      <td></td>
                      <td colspan="6" style="text-align:right;"><b>R$ {{ command.total | format_money }}</b></td>
                    </tr>

                  </table>
                </template>

                <template v-else>
                  <div style="text-align:center;padding:10px;">
                    Nenhum pedido feito.. <br>
                    <span @click="open_menu(selected.table.commands[command_index], command_index)" style="cursor:pointer;font-weight:bold;">clique aqui para adicionar um novo pedido..</span>
                    <br>
                  </div>
                  <div style="padding-top: 40px;">
                    <br>
                  </div>
                </template>

              </div>
              <br>
            </template>
          </div>

          <br><br>
        </div>

        <!--<div class="footer-panel" style="position:fixed;bottom:0;padding:6px;width: 100%;color:#ffffff;background:#202020;border-top: 2px solid #646464;">-->

        <div id="footer">
          <table id='footer-menu' style="width:100%;text-align:center;cursor:pointer;">
            <tr>
              <td style="float: left;padding-left: 10px" :class="{'menu-active': !this.selected.table, 'menu-inactive': this.selected.table}" @click="view_tables()">
                <i class="fas fa-th-list"></i>
                <br>
                <span class="font-lobster" style="font-size:14px;"> Mesas</span>
              </td>

              <!--<td>
                <i class="fas fa-history"></i>
                <br>
                <span class="font-lobster" style="font-size:14px;">Histórico</span>
              </td>
              <td>
                <i class="fas fa-shopping-cart"></i>
                <br>
                <span class="font-lobster" style="font-size:14px;">Carrinho</span>
              </td>-->

              <td v-if="selected.table && !selected.new_product" style="float: right;padding-right: 10px" @click="close_command(selected.command, selected.command_index)">
                <i class="fas fa-sign-out-alt"></i>
                <br>
                <span class="font-lobster" style="font-size:14px;">Finalizar</span>
              </td>
            </tr>

            <!--<template v-if="controls.screen.width>=1024">
            <tr>
              <td :class="{'menu-active': controls.page.current=='menu'}" @click="select_panel('menu')"><i class="fas fa-th-list"></i><br><span class="font-lobster"> Cardápio</span></td>
              <td :class="{'menu-active': controls.page.current=='history'}" @click="select_panel('history')"><i class="fas fa-history"></i><br><span class="font-lobster">Histórico</span></td>
              <td :class="{'menu-active': controls.page.current=='order'}" @click="select_panel('order')"><i class="fas fa-shopping-cart"></i><br><span class="font-lobster">Carrinho</span></td>
              <td :class="{'menu-active': controls.page.current=='close'}" @click="select_panel('confirm')"><i class="fas fa-sign-out-alt"></i><br><span class="font-lobster">Finalizar</span></td>
            </tr>
            </template>

            <template v-else>
            <tr style="font-size:11px;">
              <td :class="{'menu-active': controls.page.current=='menu'}" @click="select_panel('menu')"><i class="fas fa-th-list"></i><br><span class="font-lobster"> Cardápio</span></td>
              <td :class="{'menu-active': controls.page.current=='history'}" @click="select_panel('history')"><i class="fas fa-history"></i><br><span class="font-lobster">Histórico</span></td>
              <td :class="{'menu-active': controls.page.current=='order'}" @click="select_panel('order')"><i class="fas fa-shopping-cart"></i><br><span class="font-lobster">Carrinho</span></td>
              <td :class="{'menu-active': controls.page.current=='close'}" @click="select_panel('confirm')"><span style="font-weight:bold;">R$ 55,90</span><br><span class="font-lobster"><i class="fas fa-sign-out-alt"></i> Finalizar</span></td>
            </tr>
            </template>-->
          </table>
        </div>

        <div id="OrderModal" class="modal" tabindex="-1" role="dialog">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div v-if='selected.product' class="modal-content">
              <div class="modal-header" style='padding:0px;'>
                <img :src="(forms.order.object.image||forms.order.object.image)" style='width:100%;height:150px;object-fit:cover;' />
              </div>

              <div class="order_decoration" :style="controls.styles.themes.active.order_decoration">
                <table border="0" style="width:100%;">
                  <tr>
                    <td>
                      <b>{{ forms.order.object.name | title }}</b><br>
                    </td>

                    <td style="width:80px;text-align:center;background-color:50,50,50,0.4;">
                      <i class="fas fa-user-clock"></i> <br>
                      <template v-if="forms.order.object.expected_duration">{{ forms.order.object.expected_duration|format_text_duration }}</template>
                      <template v-else><span style="font-size:10px;">Não calculado</span></template>
                    </td>
                  </tr>
                </table>
              </div>

              <div class="modal-body" style='padding-left:30px;padding-right:30px;padding-bottom:28px;padding-top:25px;'>
                <div data-toggle="collapse" href="#product_details_panel" style='cursor:pointer;border-bottom:0.5px solid #ddd;padding-bottom:5px;'>
                  <i class="fas fa-chevron-down" style='font-size:10px;position:relative;top:-1px;'></i>
                  Produto
                  <span style="float:right;padding-right:18px;font-family:arial;">R$ {{ forms.order.object.price }}</span>
                </div>

                <div class="collapse" id="product_details_panel">
                  <table id='product_description' class='table table-sm' style=''>
                    <tr>
                      <td>
                        <template v-if="forms.order.object.product__description">
                          <span style='font-size:14px;'>{{ forms.order.object.product__description | title }}</span><br>
                        </template>
                        <template v-else>Produto sem descrição</template>
                      </td>
                    </tr>
                  </table>
                </div>

                <div style='padding-top:10px;cursor:pointer;border-bottom:0.5px solid #ddd;padding-bottom:5px;' data-toggle="collapse" href="#product_complements_panel">
                  <i class="fas fa-chevron-down" style='font-size:10px;position:relative;top:-1px;'></i> Complementos
                  <span style="float:right;padding-right:18px;font-family:arial;">R$ {{ selected.complements.total | format_money}}</span>
                </div>

                <div class="collapse" id="product_complements_panel">
                  <table id='product_complements' border="0" class='table table-sm table-stripped table-hover' style=''>
                    <tbody>
                      <template v-if='controls.screen.width>=1024'>
                        <template v-for='(complement, index) in complements'>
                          <tr>
                            <td>
                              <span style='font-size:14px;'>{{ complement.name }}</span><br>
                              <span style='font-size:10px;color:#888;'>R$ {{ complement.price | format_money }}</span>
                            </td>

                            <td style='width:60px;text-align:center;'></td>
                            <!--<td style='width:50px;text-align:center;'>
                              <template v-if='complement.quantity > 0'>{{ complement.quantity }}</template>
                            </td>-->

                            <td style='width:60px;text-align:center;'>
                              <template v-if='complement.quantity > 0'>{{ (complement.price * complement.quantity) | format_money }}</template>
                            </td>

                            <td style='width:40px;'>
                              <span class="fa-stack fa-1x" @click='decrease_complement(complement, index)' style='cursor:pointer;'>
                                <i class="fas fa-square-full fa-stack-2x"></i>
                                <i class="fa fa-minus fa-stack-1x fa-inverse"></i>
                              </span>
                            </td>

                            <td style='width:20px;padding-top:5px;text-align:center;'> {{ complement.quantity }}</td>

                            <td style='width:40px;'>
                              <span class="fa-stack fa-1x" @click='increase_complement(complement, index)' style='cursor:pointer;'>
                                <i class="fas fa-square-full fa-stack-2x"></i>
                                <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                              </span>
                            </td>
                          </tr>
                        </template>
                      </template>

                      <template v-else>
                        <template v-for='(complement, index) in complements'>
                          <tr>
                            <td><span style='font-size:14px;'>{{ complement.name }}</span><br>
                              <span style='font-size:10px;margin-left:1px;font-family:arial;'>R$ {{ complement.price | format_money}}</span>
                            </td>

                            <td style='width:50px;text-align:center;'>
                              <template v-if='complement.quantity > 0'>{{ complement.quantity }}</template>
                            </td>
                            <td style='width:50px;text-align:center;'>
                              <template v-if='complement.quantity > 0'>{{ (complement.price * complement.quantity) | format_money }}</template>
                            </td>
                            <td style='width:40px;'>
                              <span class="fa-stack fa-1x" @click='decrease_complement(complement, index)' style='cursor:pointer;'>
                                <i class="fas fa-square-full fa-stack-2x"></i>
                                <i class="fa fa-minus fa-stack-1x fa-inverse"></i>
                              </span>
                            </td>

                            <td style='width:20px;padding-top:5px;text-align:center;'>
                              {{ complement.quantity }}
                            </td>

                            <td style='width:40px;'>
                              <span class="fa-stack fa-1x" @click='increase_complement(complement, index)' style='cursor:pointer;'>
                                <i class="fas fa-square-full fa-stack-2x"></i>
                                <i class="fa fa-plus fa-stack-1x fa-inverse"></i>
                              </span>
                            </td>
                          </tr>
                        </template>
                      </template>
                    </tbody>
                  </table>
                </div>

                <div data-toggle="collapse" href="#product_observations_panel" style='padding-top:10px;cursor:pointer;border-bottom:0.5px solid #ddd;padding-bottom:5px;'>
                  <i class="fas fa-chevron-down" style='font-size:10px;position:relative;top:-1px;'></i> Observações
                </div>

                <div class="collapse" id="product_observations_panel" style="padding-top:10px;">
                  <textarea class='form-control' v-model='forms.order.object.observations' placeholder="Observações do pedido.."></textarea>
                </div>

                <div style='padding-top:10px;cursor:pointer;padding-bottom:5px;padding-left:15px;'>
                  <b>Total
                  <span style="float:right;padding-right:18px;font-family:arial;">
                    R$ {{ ( forms.order.object.quantity * forms.order.object.price ) + selected.complements.total | format_money }}
                  </span>
                  </b>
                </div>

                <br>

                <div>
                  <div class="float-left">
                    <div class="float-left">
                      <span style="font-size:10px;padding-left:4px;">Quantidade:</span><br>
                        <input class='form-control form-control-sm' type="text" v-model="forms.order.object.quantity">
                      <!--<select class='form-control form-control-sm' v-model="forms.order.object.quantity">
                        <option value="1.00">1 unidade</option>
                        <option value="2.00">2 unidades</option>
                        <option value="3.00">3 unidades</option>
                        <option value="4.00">4 unidades</option>
                        <option value="5.00">5 unidades</option>
                      </select>-->
                    </div>
                  </div>

                  <!--<button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal"> X </button>-->
                  <!--<button type="button" class="btn btn-success" @click='save_order()' style="width:120px;line-height:1;margin-top:19px;float:right;font-family:arial;">-->
                  <button type="button" class="btn btn-success" @click='add_order()' style="width:120px;line-height:1;margin-top:19px;float:right;font-family:arial;">
                    Confirmar <i class="fas fa-arrow-right"></i>
                  </button>
                </div>
              </div>

              <div class="modal-footer">
                <!--<button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Cancelar</button>->
                <button type="button" class="btn btn-sm btn-success" @click='save_order()' style="font-family:arial;">Confirmar</button>
                -->
              </div>
            </div>
          </div>
        </div>

        <div class="modal fade" id="StatusModal" tabindex="-1" role="dialog">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h4>Status</h4>
              </div>
              <div class="modal-body">
                <template v-if="selected.order">
                  <template>
                    <template class="dropdown-item" style="padding-top: 10px;height: 40px;cursor: pointer;">
                      <a class="dropdown-item" @click="change_status_order('IN_PROGRESS')" style="font-size:15px;padding-left:15px;padding-right:5px;">
                        <i class="fa fa-sync"></i>
                        PREPARANDO
                      </a>
                    </template>
                  </template>

                  <template>
                    <div class="dropdown-divider"></div>
                    <template class="dropdown-item" style="padding-top: 10px;height: 40px;cursor: pointer;">
                      <a class="dropdown-item" @click="change_status_order('READY')" style="font-size:15px;padding-left:15px;padding-right:5px;">
                        <i class="fa fa-check-square"></i>
                        PRONTO
                      </a>
                    </template>
                  </template>
                </template>
              </div>
              <div class="modal-footer">
              </div>
            </div>
          </div>
        </div>

        <!--<div id="update_command_client_modal" class="modal" tabindex="-1" role="dialog">
          <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h6 class="modal-title">Identificar comanda</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <div class="modal-body" style=''>
                <input class="form-control form-control-sm" v-model="forms.command.change_client_name" placeholder="Informe nome do cliente"/>
                <div class="row">
                  <div class="col-12">
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">-</button>
                1
                <button type="button" class="btn btn-sm btn-secondary" @click=''>+</button>

                <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-sm btn-success" @click=''>
                  R$ 45,00<br>
                  Confirmar
                </button>
              </div>
            </div>
          </div>
        </div>-->

        {% endverbatim %}
      </div>
    </div>

    {% csrf_token %}
    <script src="{% static 'vali/js/jquery-3.2.1.min.js' %}"></script>
    <script src="{% static 'vali/js/popper.min.js' %}"></script>
    <script src="{% static 'vali/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'bower_components/moment/min/moment.min.js' %}"></script>
    <script async defer src="{% static 'apps/core/authentication/action.js' %}"></script>
    <script async defer src="{% static 'bower_components/pnotify/dist/pnotify.js' %}"></script>
    <script async defer src="{% static 'apps/test_project/util/js/notify.js' %}"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.3/socket.io.min.js"></script>

    <script>
      var app = new Vue({
        el: '#app',
        mixins: [base_communications],
        data: function() {
          return {
            controls:{
              styles: {
                themes:{
                  active: {
                    'name':'Elegancia',
                    'header':{'background-color':'rgba(28, 28, 28, 0.8)', 'color':'#ffffff'},
                    'header_division':{'border-bottom':'2px solid #646464'},
                    'order_decoration':{'background-color':'rgba(28, 28, 28, 0.8)'},
                    'product_list':{'background':'#b22222'}
                  },

                  options:[
                    {
                      'name':'Connect',
                      'header':{'background':'#b22222', 'color':'#ffffff'},
                      'header_division':{'border-bottom':'2px solid #b222222'},
                      'order_decoration':{'background-color':'rgba(125, 76, 25, 0.9)'},
                      'product_list':{'background':'rgb(255, 131, 0)'}
                    },

                    {
                      'name':'Elegancia',
                      'header':{'background':'#b22222', 'color':'#ffffff'},
                      'header_division':{'border-bottom':'2px solid #b36363'},
                      'order_decoration':{'background-color':'rgba(28, 28, 28, 0.9)'},
                      'product_list':{'background':'#b22222'}
                    },

                    {
                      'name':'Energia',
                      'header':{'background':'#009000', 'color':'#ffffff'},
                      'header_division':{'border-bottom':'2px solid #2e6b23'},
                      'order_decoration':{'background-color':'rgba(13, 77, 13, 0.9)'},
                      'product_list':{'background':'#009000'}
                    },

                    {
                      'name':'Paz',
                      'header':{'background':'#191f40', 'color':'#ffffff'},
                      'header_division':{'border-bottom':'2px solid #1d2c60'},
                      'order_decoration':{'background-color':'rgba(25, 31, 64, 0.9)'},
                      'product_list':{'background':'#191f40'}
                    },
                  ]
                }
              },

              clock: null,
              screen: {
                width: window.innerWidth,
                height: window.screen.height,
                fullscreen_mode: false,
              },
              urls: {
                groups: '/api/sales/commands/groups/load/',
              }
            },

            forms: {
              command:{
                change_client_name:false,
              },

              search:{
                value: null,
                field: 'name',
                type: 'contains',
              },

              order:{
                object:{
                  command: null,
                  product: null,
                  name: null,
                  price: null,
                  quantity: null,
                  total: null,
                  checkin_time: null,
                  checkout_time: null,
                  waiting_time: null,
                  implement_time: null,
                  duration_time: null,
                  status: null,
                  was_sent: false,
                  complements: null,
                  observations: null,
                },

                conditions:{},
                backup:{},
                errors:{},
              }

            },

            selected:{
              table_group: 'GERAL',
              table: null,
              table_index: null,
              command: null,
              command_index: null,
              item: null,
              group: null,
              product: null,
              new_product: false,
              new_products: [],
              order: null,
              complements: {
                total: 0,
              },
              complements_backup: null,
              cloned_order: null,
            },

            tables:[],

            commands:{},

            complements:[
              {'id':'1', 'code': '111', 'name':'Ovo', 'price':1.50, 'quantity':0},
              {'id':'2', 'code': '222',  'name':'Queijo', 'price':2.00, 'quantity':0},
              {'id':'3', 'code': '333',  'name':'Presunto', 'price':2.00, 'quantity':0},
              {'id':'4', 'code': '444',  'name':'Hamburguer', 'price':3.50, 'quantity':0},
            ],

            groups: [],

            user: {},

            company: {
              name: "{{ company_name }}"
            },

            list_orders_id: null,
            list_orders_ready: [],

          }
        },

        filters: {
          round: function (value) {
            return value.toFixed(2);
          },

          title(value){
            if(value){
              value = value.toLowerCase().split(' ');
            }
            else{
              value = "";
            }

            let final = [];

            for (let word of value) {
              if(word.length > 2){
                final.push(word.charAt(0).toUpperCase()+ word.slice(1));
              }
              else{
                final.push(word);
              }
            }

            return final.join(' ');
          }
        },

        methods: {
          filter_tables: function (option) {
            this.selected.table_group = option;
          },

          print_command: function (command) {
            //window.open(`/api/sales/command/${command.code}/`, "_blank");
            window.location.href = `/api/sales/commands/order/view/${command.code}/`;
          },

          view_order: function (order) {
            $('#MenuModal').modal('hide');
            window.location.href = `/api/sales/commands/order/view/${this.selected.order.id}/`;
            //window.open(`/api/sales/commands/order/view/${this.selected.order.id}/`, "_blank");
          },

          print_order: function (orders) {
            let scope = this;
            let data_paramters = {};
            let now = moment();
            data_paramters["checkin_time"] = now.format();
            data_paramters["table_id"] = scope.selected.table.id
            data_paramters["command_id"] = scope.selected.command.id;
            data_paramters["attendant_name"] = scope.user.first_name;
            data_paramters["orders"] = JSON.stringify(orders);

            success_function = function () {
              swal({
                title: scope.company.name,
                text: "Pedido enviado para cozinha com sucesso!",
                icon: "success",
                button: false,
                timer: 3000
              }).then((close) => {
                scope.view_tables();
              });

              $('#MenuModal').modal('hide');
            }

            failure_function = function () {
              swal({
                title: scope.company.name,
                text: "Erro! Não foi possivel enviar o pedido para cozinha!",
                icon: "warning",
                button: false,
                timer: 3000
              })
            }

            this.request('/api/sales/commands/order/print/', "post", data_paramters, null, success_function, failure_function);
          },

          reprint_order: function (order) {
            let scope = this;
            let data_paramters = {};
            success_function = function () {
              swal({
                title: scope.company.name,
                text: "Pedido reenviado para cozinha com sucesso!",
                icon: "success",
                button: false,
                timer: 3000
              });

              $('#MenuModal').modal('hide');
            }

            failure_function = function () {
              swal({
                title: scope.company.name,
                text: "Erro! Não foi possivel reenviar o pedido para cozinha!",
                icon: "warning",
                button: false,
                timer: 3000
              })
            }

            this.request(`/api/sales/commands/order/reprint/${order}/`, "post", data_paramters, null, success_function, failure_function);
          },

          print_order_command: function() {
            let scope = this;
            let data_paramters = {"command_id": scope.selected.command.id}
            success_function = function() {
              swal({
                title: scope.company.name,
                text: "Pedido enviado para cozinha com sucesso!",
                icon: "success",
                button: false,
                timer: 3000
              });

              $('#MenuModal').modal('hide');

            }

            failure_function = function(){
              swal({
                title: scope.company.name,
                text: "Erro! Não foi possivel enviar o pedido para cozinha!",
                icon: "warning",
                button: false,
                timer: 3000
              })
            }

            this.request('/api/sales/commands/order/print/', "post", data_paramters, null, success_function, failure_function);
          },

          confirm_item: function (item) {
            alert("confirmei");
          },

          confirm_new_itens: function () {
            let scope = this;

            for (index in this.selected.new_products) {
              var value = this.selected.new_products[index];
              value.is_confirmed = true;
              this.selected.table.products.unshift(value);
            }

            this.selected.new_products = [];
          },

          show_options: function (command_index , order, order_index) {
            if(this.selected.order){
              if(this.selected.order.id==order.id){
                this.selected.table.commands[command_index].orders[order_index].show_options = false;
                // this.selected.command_index = null;
                this.selected.order_index = null;
                this.selected.order = null;
              }
              else{
                this.selected.table.commands[command_index].orders[this.selected.order_index].show_options = false;
                this.selected.table.commands[command_index].orders[order_index].show_options = true;
                this.selected.command_index = command_index;
                this.selected.order_index = order_index;
                this.selected.order = order;
              }
            }
            else{
              this.selected.table.commands[command_index].orders[order_index].show_options = true;
              this.selected.command_index = command_index;
              this.selected.order_index = order_index;
              this.selected.order = order;
            }
          },

          open_client_name_field: function () {
            this.forms.command.change_client_name = true;
          },

          confirm_client_name_field: function () {
            this.forms.command.change_client_name = false;
          },

          get_prevision_duration: function () {
            let hours = Math.random() * 2 | 0;
            let minutes = Math.random() * 59 | 0;
            let seconds = Math.random() * 59 | 0;
            return moment.duration({hours: hours, minutes: minutes, seconds: seconds})
          },

          add_order: function () {
            let scope = this;

            scope.forms.order.object.complements = JSON.parse(JSON.stringify(scope.check_complements(scope.complements, scope.complements_backup)));

            if (!scope.selected.command.orders) {
              scope.selected.command.orders = [];
            }

            let now = moment();
            let duration = scope.get_prevision_duration();
            scope.forms.order.object.checkin_time = now.format();
            scope.forms.order.object.checkout_time = null;
            scope.forms.order.object.waiting_time = null;
            scope.forms.order.object.implement_time = null;
            scope.forms.order.object.status = "WAITING";
            scope.forms.order.object.was_sent = false;

            scope.forms.order.object.duration_time = {
              hours: duration.hours(), minutes: duration.minutes(), seconds: duration.seconds()
            };

            scope.forms.order.object.expected_time = now.add({
              hours: duration.hours(), minutes: duration.minutes(), seconds: duration.seconds()
            }).format();

            if (scope.selected.cloned_order) {
              Vue.set(scope.selected.command.orders, scope.selected.order_index, scope.forms.order.object);
              scope.selected.cloned_order = null;
            } else {
              scope.selected.command.orders.unshift(scope.forms.order.object);
            }

            scope.selected.command.total = scope.calculate_command_total();
            scope.selected.table.total = scope.calculate_table_total();

            scope.selected.group = null;
            scope.selected.product = null;
            // scope.selected.command = null;
            scope.selected.new_product = null;
            scope.selected.complements.total = 0;
            scope.selected.new_products.splice(0, scope.selected.new_products.length);

            for (index in scope.complements) {
              scope.complements[index].quantity = 0;
            }

            $('#OrderModal').modal('hide');
          },

          calculate_command_total: function () {
            let scope = this;
            let total = 0;
            let complements_total = 0

            for (index in scope.selected.command.orders) {
              for (idx in scope.selected.command.orders[index].complements) {
                complements_total += scope.selected.command.orders[index].complements[idx].quantity * scope.selected.command.orders[index].complements[idx].price;
              }
              total += scope.selected.command.orders[index].price * scope.selected.command.orders[index].quantity;
            }
            return parseFloat(total + complements_total);
          },

          calculate_table_total: function () {
            let scope = this;
            let total = 0;

            for (index in scope.selected.table.commands) {
              total += scope.selected.table.commands[index].total;
            }

            return parseFloat(total);
          },

          prepare_order: function () {
            let scope = this;
            let data_paramters = {};
            let list_items = [];
            let list_indexes = [];

            if (scope.selected.command_index >= 0) {
              for (index in scope.selected.table.commands[scope.selected.command_index].orders) {
                if (!scope.selected.table.commands[scope.selected.command_index].orders[index].was_sent){
                  list_items.unshift(scope.selected.table.commands[scope.selected.command_index].orders[index]);
                  list_indexes.unshift(index);
                }
              }
            }

            if (list_items.length > 0) {
              data_paramters["items"] = JSON.stringify(list_items);
              data_paramters['command_id'] = scope.selected.table.commands[scope.selected.command_index].id;
              data_paramters['complements_total'] = scope.selected.complements.total;

              console.log(JSON.stringify(data_paramters));

              let success_function = function (response) {
                response.object.show_options = false;

                console.log(JSON.stringify(response.object.items));
                console.log(JSON.stringify(response.object));

                if (!scope.list_orders_id) {
                  scope.list_orders_id = [];
                }
                scope.list_orders_id.unshift(response.object.id);

                let list_items_id = [];

                for (index in response.object.items) {
                  list_items_id.unshift(response.object.items[index].id);
                }

                for (index in list_items) {
                  Vue.set(scope.selected.command.orders, index, response.object.items[index]);
                }

                scope.print_order(response.object);

                swal({
                  title: scope.company.name,
                  text: "Pedido anotado e diponível para ser enviado a cozinha.",
                  icon: "success",
                  button: false,
                  timer: 3000
                })

              };

              let failure_function = function (response) {
                swal({
                  title: scope.company.name,
                  text: "Erro! Não foi possivel gerar o pedido.",
                  icon: "warning",
                  button: false,
                  timer: 1000
                })

                return false;
              };

              this.request('/api/sales/commands/order/save/', "post", data_paramters, null, success_function, failure_function);
            }
          },

          cancel_item: function (order_index, order) {
            let scope = this;
            scope.selected.command.orders.splice(order_index, 1);
            scope.selected.order = null;
            $('#MenuModal').modal('hide');
          },

          save_order: function () {
            let scope = this;
            let data_paramters = {};
            let complements = scope.check_complements(scope.complements, scope.complements_backup);
            console.log(JSON.stringify(complements));

            data_paramters = scope.forms.order.object;
            data_paramters['command_id'] = scope.selected.command.id;
            data_paramters['orders_total'] = scope.selected.product.price * scope.forms.order.object.quantity;
            data_paramters['complements_total'] = scope.selected.complements.total;
            data_paramters['complements'] = JSON.stringify(complements);

            let success_function = function (response) {
              /*swal({
                title: scope.company.name,
                text: "Pedido anotado e diponível para ser enviado a cozinha.",
                icon: "success",
                button: false,
                timer: 2000
              })*/

              response.object.show_options = false;

              if (!scope.selected.command.orders) {
                scope.selected.command.orders = [];
              }

              scope.selected.command.orders.unshift(response.object);
              console.log(JSON.stringify(response.object));

              scope.selected.command.total = parseFloat(scope.selected.command.total) + parseFloat(response.object.total);
              scope.selected.table.total = parseFloat(scope.selected.table.total) + parseFloat(response.object.total);
              scope.selected.new_product = null;
              scope.selected.new_products.splice(0, scope.selected.new_products.length);
              scope.selected.complements.total = 0;

              for (index in scope.complements) {
                scope.complements[index].quantity = 0;
              }

              scope.selected.group = null;
              scope.selected.product = null;
              scope.selected.command = null;
              $('#OrderModal').modal('hide');
            };

            let failure_function = function (response) {
              swal({
                title: scope.company.name,
                text: "Erro! Não foi possivel gerar o pedido.",
                icon: "warning",
                button: false,
                timer: 2000
              })
              return false;
            };

            this.request('/api/sales/commands/order/save/', "post", data_paramters, null, success_function, failure_function);
          },

          select_item: function (command, item) {
            this.selected.command = command;
            this.selected.product["code"] = 0;
            this.selected.product["id"] = parseInt(item.product)
            this.selected.product["name"] = item.name
            this.selected.product["image"] = item.image
            this.selected.product["price"] = item.price
            this.selected.product["quantity"] = 1
            this.selected.product["description"] = ""
            this.selected.product["have_promotion"] = true
            this.selected.product["is_confirmed"] = false
            this.selected.product["show_options"] = false
          },

          unselect_item: function (item) {
            this.selected.item = null;
          },

          increase_complement: function (complement, index) {
            this.complements[index].quantity += 1
            this.selected.complements.total += this.complements[index].price;
          },

          decrease_complement: function (complement, index) {
            if(this.complements[index].quantity > 0){
              this.complements[index].quantity -= 1
              this.selected.complements.total -= this.complements[index].price;
            }
            else{
              this.complements[index].quantity = 0
            }
          },

          verify_screen: function () {
            this.controls.screen.width = window.innerWidth;
            this.controls.screen.height = window.innerHeight;

            let is_mobile = false;
            (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);

            if(!is_mobile){
              if((screen.availHeight || screen.height - 30) <= window.innerHeight) {
                this.controls.screen.fullscreen_mode = true;
              } else {
                this.controls.screen.fullscreen_mode = false;
              }
            }

          },

          init_complements: function() {

          },

          view_tables: function () {
            let scope = this;

            if (scope.selected.command && scope.check_unsent_orders()) {
              swal({
                title: scope.company.name,
                text: "Existem pedidos que não foram confirmados, deseja mesmo continuar ???",
                icon: "warning",
                buttons: true,
              }).then((close) => {
                if (close) {
                  history.go(0);
                }
              })
            } else {
              history.go(0);
            }

          },

          back_menu: function () {
            if(this.selected.product){
               //$('#OrderModal').modal('hide');
              this.selected.product = null;
              history.pushState(null, document.title, location.href);
            }

            else if(this.selected.group){
              this.selected.group = null;
              history.pushState(null, document.title, location.href);
            }

            else if(this.selected.command){
              this.selected.command = null;
              this.selected.command_index = null;
              this.selected.new_product = false;
              history.pushState(null, document.title, location.href);
            }

            else if(this.selected.table){
              this.selected.table = null;
              history.pushState(null, document.title, location.href);
            }

            else{
              this.view_tables();
            }
            //history.pushState(null, document.title, location.href);
          },

          open_menu: function (command, index) {
            let scope = this;
            scope.selected.command = command;
            scope.selected.new_product = true;
            scope.selected.command_index = index;
          },

          change_order: function (command, command_index, order) {
            let scope = this;
            scope.selected.cloned_order = JSON.parse(JSON.stringify(order));
            scope.forms.order.object = scope.selected.cloned_order;
            scope.selected.command = command;
            scope.selected.product = order;
            scope.selected.product.id = order.product;
          },

          change_status_order: function (status) {
            let scope = this;
            let item_id = scope.selected.order.id;
            let data_paramters = {};

            console.log(scope.selected.command);
            console.log(scope.selected.command_index);

            data_paramters["table_id"] = scope.selected.command.table;
            data_paramters["table_index"] = scope.selected.table_index;
            data_paramters["command_index"] = scope.selected.command_index;
            data_paramters["item_index"] = scope.selected.order_index;

            scope.selected.order.status = status;

            $('#StatusModal').modal('hide');
            let success_function = function (response) {
              //scope.selected.command.order.unshift(response.object);
              Vue.set(scope.selected.command.orders, scope.selected.order_index, response.object);
              $('#MenuModal').modal('hide');
            };

            let failure_function = function (response) {
              //
            };

            this.request(`/api/sales/commands/orders/item/${item_id}/status/${status}/change/`, "post", data_paramters, null, success_function, failure_function)
          },

          delivered_item: function (index, order, status) {
            let scope = this;
            let item_id = order.id;
            let data_paramters = {};
            let success_function = function (response) {
              //scope.selected.command.order.unshift(response.object);
              Vue.set(scope.selected.command.orders, index, response.object);
              $('#MenuModal').modal('hide');
            };

            let failure_function = function (response) {
              //;
            };

            this.request(`/api/sales/commands/orders/item/${item_id}/status/${status}/change/`, "post", data_paramters, null, success_function, failure_function)
          },

          load_tables: function () {
            let scope = this;

            let success_function = function(response) {
              scope.tables = response.object;
              //console.log(JSON.stringify(scope.tables));
            };

            let failure_function = function(response) {
              return false;
            };

            this.request('/api/sales/commands/tables/load/', "get", null, null, success_function, failure_function);
          },

          open_table: function (table, index, is_fake_new) {
            let scope = this;
            let data_paramters = {'table_id': table.id}

            let success_function = function (response) {
              Vue.set(scope.tables, index, response.object);

              if (!is_fake_new) {
                scope.open_command(table, index);
              }

            };

            let failure_function = function (response) {};

            this.request('/api/sales/commands/tables/open/', "post", data_paramters, null, success_function, failure_function);
          },

          close_table: function (table, index) {
            let scope = this;
            let data_paramters = {}

            let success_function = function (response) {
              scope.tables[index] = response.object;
            };

            let failure_function = function (response) {

            };

            this.request(`/api/sales/commands/table/close/${table.id}/`, "post", data_paramters, null, success_function, failure_function);
          },

          select_table: function (table, index) {
            let scope = this;

            if (table.status === 'CLOSED') {
              swal({
                title: scope.company.name,
                text: `Abrir nova comanda na mesa ${table.code} ???`,
                icon: "warning",
                buttons: true,
              }).then((open) => {
                if (open) {
                  scope.open_table(table, index);
                }
              });

            } else{
              scope.selected.table = table;
              scope.selected.table_index = index;
              scope.selected.command_index = 0;
              scope.selected.command = scope.selected.table.commands[scope.selected.command_index];
              scope.list_orders_id = [];
              let before_id = null;
              for (index in scope.selected.command.orders) {
                if (before_id !== scope.selected.table.commands[scope.selected.command_index].orders[index].order) {
                  before_id = scope.selected.table.commands[scope.selected.command_index].orders[index].order;
                  scope.list_orders_id.unshift(before_id);
                }
              }
              if (scope.selected.command.orders && scope.selected.command.orders.length == 0) {
                scope.open_menu(scope.selected.command, scope.selected.command_index);
              }
              scope.selected.command.total = scope.calculate_command_total();
              scope.selected.table.total = scope.calculate_table_total();
            }
          },

          unselect_table: function (table) {
            this.selected.table = null;
          },

          open_command: function (table, table_index) {
            let scope = this;
            let data_paramters = {'table_id':table.id}

            let success_function = function (response) {
              scope.tables[table_index].commands.push(response.object);

              if(scope.selected.table == null) {
                scope.selected.table = scope.tables[table_index];
                scope.selected.table_index = table_index;
                scope.selected.command_index = 0;
                scope.selected.command = scope.selected.table.commands[scope.selected.command_index];
                scope.open_menu(scope.selected.command, scope.selected.command_index);
              }

              $('#MenuModal').modal('hide');
            };

            let failure_function = function (response) {
              swal({
                title: scope.company.name,
                text: "Erro! Não foi possivel abrir nova comanda.",
                icon: "warning",
                button: false,
                timer: 5000
              })
            };

            this.request('/api/sales/commands/open/', "post", data_paramters, null, success_function, failure_function);
          },

          check_unsent_orders: function () {
            let scope = this;

            for (index in scope.selected.command.orders) {
              if(!scope.selected.command.orders[index].was_sent) {
                return true;
              }
            }

            return false;
          },

          view_orders_ready: function () {
            alert("VOU CRIAR UM MODAL PARA GERENCIAR OS PEDIDOS PRONTOS...");
            scope.list_orders_ready = [];
          },

          close_command: function (command, index) {
            let scope = this;
            let data_paramters = {};
            let table = scope.selected.table;
            let table_index = scope.selected.table_index;

            if (scope.check_unsent_orders()) {
              swal({
                title: scope.company.name,
                text: "Existem pedidos que não foram confirmados!",
                icon: "warning",
                button: false,
                timer: 2000
              })
              return false;
            } else {
              data_paramters["is_last_command"] = false;
              if (scope.selected.table.commands.length == 1) {
                data_paramters["is_last_command"] = true;
              }
              if(scope.selected.table.commands[index].status=='OPEN') {
                swal({
                  title: scope.company.name,
                  text: `Deseja mesmo finalizar a comanda ${command.code} ???`,
                  icon: "warning",
                  buttons: true,
                }).then((close) => {
                  if (close) {
                    let success_function = function (response) {
                      scope.selected.table.commands.splice(index, 1);
                      if (scope.selected.table.commands.length == 0) {
                        swal({
                          title: scope.company.name,
                          text: `Sem comanda aberta, liberar mesa ${table.code} ???`,
                          icon: "warning",
                          buttons: true,
                        }).then((open) => {
                          if (open) {
                            scope.view_tables();
                          } else {
                            scope.selected.table.total = 0;
                          }
                        });
                      }
                    };
                    let failure_function = function (response) {
                      //;
                    };
                    this.request(`/api/sales/commands/close/${command.id}/`, "post", data_paramters, null, success_function, failure_function);
                  }
                });
              }
            }
          },

          load_groups: function () {
            let scope = this;
            let success_function = function (response) {
              for (index in response.object) {
                if (response.object[index].products.length > 0) {
                  scope.groups.push(response.object[index]);
                }
              }
            };

            let failure_function = function (response) {
              return false;
            };

            this.request('/api/sales/commands/groups/load/', "get", null, null, success_function, failure_function);
          },

          update_clock: function() {
            //this.controls.clock = moment().utc().format();
            this.controls.clock = moment().format();
          },

          check_complements: function (object, backup) {
            let scope = this;
            let newObj = [];
            let filtered_object = null;

            $.each(object, function (key, value) {
              if (backup[key]["quantity"] < value["quantity"]) {
                newObj[key] = object[key];
              }
            });

            filtered_object = newObj.filter(function (el) {
              return el;
            });
            return filtered_object;
          },

          get_user: function () {
            let scope = this;
            let data_parameters = {};
            let success_function = function (response) {
              scope.errors = response.message;
              scope.user = response.object;
              scope.user.password = '';
              //scope.session.is_blocked = response.object.session.is_blocked;
              //localStorage.setItem("is_blocked", response.object.session.is_blocked);
              //scope.controls.page.loaded = true;
            };

            let failure_function = function (response) {
              window.location.href = "/sales/commands/login";
            };

            this.request('/api/core/authentication/get_user/', 'get', data_parameters, null, success_function, failure_function);
          },
        },

        computed: {
          current_time: function () {
            if(this.controls.clock) {
              return moment(String(this.controls.clock)).format('HH:mm:ss');
            }
          },

          /*product_in_command: function () {
            let new_array = [];
            this.selected.table.commands.products.forEach(function (item, chave) {
              if(item.quant > 0){
                new_array.push(item);
              }
              else{
                alert(`${item.name}: ${item.quant} TIRAR`);
              }
            });
            this.selected.table.products = new_array;
            return this.selected.table.products;
          },*/

        },

        created: function () {
          //this.load_tables();
          //this.init_product_complements();
          this.complements_backup = JSON.parse(JSON.stringify(this.complements));
        },

        mounted: function () {
          let scope = this;
          let status = null;
          let socket = io.connect();

          socket.on('connect', function() {
            socket.emit('my_event', {data: 'I\'m connected!'});
          });
          socket.on('disconnect', function() {
            $('#log').append('<br>Disconnected');
          });
          socket.on('change_status', function(msg) {
            console.log(`Received: ${JSON.stringify(msg.data)}`);
            let result_object = msg.data.object;
            scope.tables[result_object.table_index].commands[result_object.command_index].orders[result_object.item_index].status = result_object.status;

            if (result_object.status === "READY") {
              let audio = new Audio('/media/notification.mp3');
              audio.play();

              scope.list_orders_ready.unshift(result_object);

              let table_class = document.querySelector('#table-icon_' + result_object.table_index);
              status = "PRONTO";
              table = result_object.table;

              if (table_class) {
                table_class.classList.add("pisca");
              }

              swal({
                //title: scope.company.name,
                title: "PEDIDO PRONTO",
                text: `MESA ${table}`,
                content: {
                      element: 'p',
                      attributes: {
                        innerHTML: `${result_object.name}`,
                      },
                    },
                icon: "success",
                button: false,
                timer: 5000
              });

            }
          });
        }
      });
    </script>

    <script>
      history.pushState(null, document.title, location.href);
      window.addEventListener('popstate', function (event) {
        app.back_menu();
      });

    </script>

    <script type="text/javascript" charset="utf-8">
      function success_notify () {
        //;
      };

      window.addEventListener('load', function () {
        app.get_user();
        app.load_tables();
        app.load_groups();
        //register_action();
      }, false);

      window.addEventListener('resize', function (e) {
        app.verify_screen();
      });

      var clock = setInterval(function () {
        app.update_clock()
      }, 1000);

    /*$(document).ready(function(){
      let socket = io.connect();

      socket.on('connect', function() {
          socket.emit('my_event', {data: 'I\'m connected!'});
      });
      socket.on('disconnect', function() {
          $('#log').append('<br>Disconnected');
      });
      socket.on('change_status', function(msg) {
          console.log(`Received: ${JSON.stringify(msg.data)}`);
      });
    });*/
    </script>
  </body>
</html>